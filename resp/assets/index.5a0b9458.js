var Ho=Object.defineProperty;var Vo=(t,e,n)=>e in t?Ho(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var A=(t,e,n)=>(Vo(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerpolicy&&(r.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?r.credentials="include":i.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();const Yo=[0,31,59,90,120,151,181,212,243,273,304,334],Wo=1e3,Xo=60*Wo,V=(t,e)=>t!=null&&typeof t[e]=="function",O=t=>typeof t=="number",I=t=>typeof t=="string",Zo=t=>I(t)||O(t)?new Date(t):V(t,"toDate")?t.toDate():t,Wi=t=>!(t%4)&&(!!(t%100)||!(t%400));function xt(t,e){return!e&&(e={}),(...n)=>{const s=JSON.stringify(n);return s!==void 0?s in e?e[s]:e[s]=t.apply(null,n):t.apply(null,n)}}const Xi=xt((t,e)=>t.repeat(e)),pn=xt((t,e=" ")=>{const n=Xi(String(e),t);return(s,i)=>s==null?n:(s=s.toString(),i=i!==void 0?i:s.length,i<t?n.substring(i)+s:s)}),q=pn(2,"0"),Jo=pn(3,"0"),Ko=pn(4,"0"),Zi=t=>typeof t=="function",Qo={months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],sepHM:".",date:["dd","/DM","MM","/MY","yyyy"],time:["h","/HM","mm"," ","a"],units:{y:{s:"y",p:"y"},M:{s:"m",p:"m"},d:{s:"d",p:"d"},h:{s:"h",p:"h"},m:{s:"min",p:"min"},s:{s:"s",p:"s"},t:{s:"ms",p:"ms"}},less:"< %s",past:"%s ago",now:"just now",future:"in %s"},ta=t=>{const e={sepED:" ",sepDM:"/",sepMY:"/",sepHM:":",date:["E","/ED","d","/DM","MMM","/MY","yyyy"],time:["H","/HM","mm"],...t};return!e.dateTime&&(e.dateTime=[...e.date,", ",...e.time]),e};let St=ta(Qo);const ea=(t,e,n)=>Yo[e]+n+~~(e>1&&Wi(t)),na=(t,e,n)=>{const s=new Date(Date.UTC(t,0,1)).getDay()||7;if(!e){if(s===5&&n<4)return 53;if(s===6&&n<3)return 52+~~Wi(t-1);if(s===7&&n<2)return 52}const i=(s<5?8:15)-s;return Math.ceil((ea(t,e,n)-i)/7+1)},ls={yyyy:t=>Ko(t.getFullYear()),yy:t=>q(t.getFullYear()%100),MMM:t=>St.months[t.getMonth()],MM:t=>q(t.getMonth()+1),M:t=>String(t.getMonth()+1),dd:t=>q(t.getDate()),d:t=>String(t.getDate()),E:t=>St.days[t.getDay()],ww:t=>q(ls.w(t,!1)),w:t=>String(na(t.getFullYear(),t.getMonth(),t.getDate())),q:t=>String((t.getMonth()/3|0)+1),HH:t=>q(t.getHours()),H:t=>String(t.getHours()),hh:t=>{const e=t.getHours()%12;return q(e>0?e:12)},h:t=>{const e=t.getHours()%12;return String(e>0?e:12)},mm:t=>q(t.getMinutes()),m:t=>String(t.getMinutes()),ss:t=>q(t.getSeconds()),s:t=>String(t.getSeconds()),SS:t=>Jo(t.getMilliseconds()),S:t=>String(t.getMilliseconds()),A:t=>String(t.getHours()<12?"AM":"PM"),a:t=>String(t.getHours()<12?"am":"pm"),Z:(t,e=!1)=>{const n=e?0:t.getTimezoneOffset(),s=Math.abs(n);return`${n<0?"+":"-"}${q(s/60|0)}:${q(s%60)}`},ZZ:(t,e=!1)=>e?"Z":ls.Z(t,e),"/DM":()=>St.sepDM,"/ED":()=>St.sepED,"/HM":()=>St.sepHM,"/MY":()=>St.sepMY},sa=t=>(e=Date.now(),n=!1)=>{let s=Zo(e);return n&&(s=new Date(s.getTime()+s.getTimezoneOffset()*Xo)),t.map(i=>{let r;return I(i)?i.startsWith("\\")?i.substring(1):(r=ls[i])?r(s,n):i:Zi(i)?i(s,n):i}).join("")},ia=sa(["yyyy","MM","dd","-","HH","mm","ss"]),Ji=(t,e,n)=>{const s={expire:1e4,utf8:!1,...n};I(e)&&s.utf8&&(e=new TextEncoder().encode(e),s.mime+=";charset=UTF-8");const i=URL.createObjectURL(e instanceof Blob?e:new Blob([e],{type:s.mime})),r=document.createElement("a");r.setAttribute("download",t),r.setAttribute("href",i),document.body.appendChild(r),r.click(),document.body.removeChild(r),s.expire>0&&setTimeout(()=>URL.revokeObjectURL(i),s.expire)},ra=(t,e,n="png",s=.95)=>{const i=`image/${n}`;t.toBlob(r=>r?Ji(`${e}.${n}`,r,{mime:i}):console.warn("can't download canvas"),i,s)},oa=(t,e,n)=>{n={fps:60,mimeType:"video/webm; codecs=vp9",...n};const s=t.captureStream(n.fps),i=new MediaRecorder(s,{mimeType:n.mimeType});let r=[];return i.ondataavailable=o=>{o.data.size>0&&(r.push(o.data),Ji(e,new Blob(r,{type:n.mimeType}),{mime:n.mimeType}),r=[])},i},aa=(t,e,n=!1)=>{const s=typeof global<"u"?global:typeof window<"u"?window:void 0;s&&(n||(typeof process<"u"&&process.env!==void 0?!!{}.UMBRELLA_GLOBALS:!!{}.VITE_UMBRELLA_GLOBALS))&&(s[t]=e)},Se=(t,e=n=>n!==void 0?": "+n:"")=>class extends Error{constructor(n){super(t(n)+e(n))}},ca=Se(()=>"illegal arity"),_s=t=>{throw new ca(t)};function Ki(...t){let[e,n,s,i,r,o,a,c,l,f]=t;switch(t.length){case 0:_s(0);case 1:return e;case 2:return(...u)=>e(n(...u));case 3:return(...u)=>e(n(s(...u)));case 4:return(...u)=>e(n(s(i(...u))));case 5:return(...u)=>e(n(s(i(r(...u)))));case 6:return(...u)=>e(n(s(i(r(o(...u))))));case 7:return(...u)=>e(n(s(i(r(o(a(...u)))))));case 8:return(...u)=>e(n(s(i(r(o(a(c(...u))))))));case 9:return(...u)=>e(n(s(i(r(o(a(c(l(...u)))))))));case 10:default:const h=(...u)=>e(n(s(i(r(o(a(c(l(f(...u))))))))));return t.length===10?h:Ki(h,...t.slice(10))}}const bn=t=>V(t,"xform")?t.xform():t;function Is(...t){return t=t.map(bn),Ki.apply(null,t)}const yn=t=>t!=null&&typeof t[Symbol.iterator]=="function",wn=(t,e)=>[t[0],t[1],e],Kt=Symbol(),li=()=>{},An=t=>t!=null&&typeof t!="function"&&t.length!==void 0;class ae{constructor(e){this.value=e}deref(){return this.value}}const la=t=>new ae(t),_t=t=>t instanceof ae,fa=t=>t instanceof ae?t:new ae(t),Le=t=>t instanceof ae?t.deref():t,ua=t=>t.length===2?[void 0,t[1]]:t.length===3?[t[1],t[2]]:_s(t.length);function ha(...t){const e=t[0],n=e[0],s=e[1],i=e[2];t=ua(t);const r=t[0]==null?n():t[0],o=t[1];return Le(s(V(o,"$reduce")?o.$reduce(i,r):An(o)?da(i,r,o):ga(i,r,o)))}const da=(t,e,n)=>{for(let s=0,i=n.length;s<i;s++)if(e=t(e,n[s]),_t(e)){e=e.deref();break}return e},ga=(t,e,n)=>{for(let s of n)if(e=t(e,s),_t(e)){e=e.deref();break}return e},Qi=(t,e)=>[t,n=>n,e];function ks(t){return t?[...t]:Qi(()=>[],(e,n)=>(e.push(n),e))}function*ma(t,e){const n=bn(t)(ks()),s=n[1],i=n[2];for(let r of e){const o=i([],r);if(_t(o)){yield*Le(s(o.deref()));return}o.length&&(yield*o)}yield*Le(s([]))}function*Sn(t,e){const n=bn(t)([li,li,(s,i)=>i])[2];for(let s of e){let i=n(Kt,s);if(_t(i)){i=Le(i.deref()),i!==Kt&&(yield i);return}i!==Kt&&(yield i)}}const pa=(t,e,n=Sn)=>{const s=e.length-1;return yn(e[s])?e.length>1?n(t.apply(null,e.slice(0,s)),e[s]):n(t(),e[0]):void 0};function Y(t,e){return yn(e)?Sn(Y(t),e):n=>{const s=n[2];return wn(n,(i,r)=>s(i,t(r)))}}function tr(...t){return pa(tr,t)||(e=>{const n=e[2],s=t[0];let i=t[1]||0;return wn(e,(r,o)=>n(r,s(i++,o)))})}function er(t,e,n){return new ba(t,e,n)}class ba{constructor(e,n,s){e===void 0?(e=0,n=1/0):n===void 0&&(n=e,e=0),s=s===void 0?e<n?1:-1:s,this.from=e,this.to=n,this.step=s}*[Symbol.iterator](){let{from:e,to:n,step:s}=this;if(s>0)for(;e<n;)yield e,e+=s;else if(s<0)for(;e>n;)yield e,e+=s}$reduce(e,n){const s=this.step;if(s>0)for(let i=this.from,r=this.to;i<r&&!_t(n);i+=s)n=e(n,i);else for(let i=this.from,r=this.to;i>r&&!_t(n);i+=s)n=e(n,i);return n}}function ya(t,e){t=t||"";let n=!0;return e?[...e].join(t):Qi(()=>"",(s,i)=>(s=n?s+i:s+t+i,n=!1,s))}function nr(t,e){return yn(e)?ma(nr(t),e):n=>{const s=n[2];let i=t;return wn(n,(r,o)=>--i>0?s(r,o):i===0?fa(s(r,o)):la(r))}}function Mn(...t){return wa(Mn,ha,t)}const wa=(t,e,n)=>{let s,i;switch(n.length){case 4:i=n[3],s=n[2];break;case 3:i=n[2];break;case 2:return Y(r=>t(n[0],n[1],r));default:_s(n.length)}return e(bn(n[0])(n[1]),s,i)};function*qe(...t){const e=t.map(n=>n[Symbol.iterator]());for(;;){const n=[];for(let s of e){let i=s.next();if(i.done)return;n.push(i.value)}yield n}}const Aa=Se(()=>"unsupported operation"),Me=t=>{throw new Aa(t)},dt=(t=0)=>{const e=new Array(5);let n;const s=(...i)=>{const r=e[i[t].length]||n;return r?r(...i):Me(`no impl for vec size ${i[t].length}`)};return s.add=(i,r)=>e[i]=r,s.default=i=>n=i,s.impl=i=>e[i]||n,s},Cs="o,a",ce="o,a,b",sr="o,a,b,c",Sa="o,a,n",Ma="o,a,n,b",va="o,a,b,n",ir="io=0,ia=0,so=1,sa=1",Ra="io=0,ia=0,ib=0,so=1,sa=1,sb=1",Fa="!o&&(o=a);",rr="!o&&(o=[]);",or="!a&&(a=[]);",$a=t=>([e,n,s])=>`${e}=${n}${t}${s};`,_a=t=>([e,n])=>`${e}=${n}${t}n;`,Ia=(t,e)=>([n,s,i])=>`${n}=(${s}${t}n)${e}${i};`,Es=(t="op")=>([e,n])=>`${e}=${t}(${n});`,ar=(t="op")=>([e,n,s])=>`${e}=${t}(${n},${s});`,ka=(t="op")=>([e,n,s,i])=>`${e}=${t}(${n},${s},${i});`,cr=([t,e])=>`${t}*${e}`,Ca=([t,e])=>`s+=${t}*${e};`,lr=([t,e])=>`${t}=${e};`,Ea=([t,e,n,s])=>`${t}=${e}+(${n}-${e})*${s};`,Oa=([t,e,n])=>`${t}=${e}+(${n}-${e})*n;`,Da=t=>e=>e>1?`${t}[i${t}+${e}*s${t}]`:e==1?`${t}[i${t}+s${t}]`:`${t}[i${t}]`,xa=t=>Y(Da(t),er()),Na=t=>Y(e=>`${t}[${e}]`,er()),fr=(t,e,n,s="a",i="",r="",o="",a=!1)=>[r,Mn(Is(nr(t),tr((c,l)=>e(l,c))),ya(i),qe.apply(null,n.split(",").map(a?xa:Na))),o,s!==""?`return ${s};`:""],ur=(t,e,n="a",s,i,r=!1)=>[s,"for(let i=a.length;--i>=0;) {",t(e.split(",").map(r?o=>`${o}[i${o}+i*s${o}]`:o=>`${o}[i]`)),"}",i,n!==null?`return ${n};`:""],Ta=(t,e=ce,n="o",s=Fa,i)=>[s,"while(k-->0) {",t(e.split(",").map(r=>`${r}[i${r}+k*s${r}]`)),"}",i,n!==null?`return ${n};`:""],Os=(t,e)=>`!${t} && (${t}=${e.split(",")[1]});`,Nt=(t,e,n,s=n,i="a",r,o,a,c=!1)=>new Function(n,fr(t,e,s,i,r,o,a,c).join("")),hr=(t,e,n,s,i,r=i,o="a",a="",c,l,f=!1)=>new Function(s,`return (${i})=>{${fr(t,n,r,o,a,c,l,f).join("")}}`)(...e),vn=(t,e,n=e,s="a",i,r,o=!1)=>new Function(e,ur(t,n,s,i,r,o).join("")),za=(t,e,n=e,s,i,r)=>new Function(e,Ta(t,n,s,i,r).join("")),Ba=(t,e,n,s,i=s,r="a",o,a,c=!1)=>new Function(n,`return (${s})=>{${ur(e,i,r,o,a,c).join("")}}`)(...t),gt=(t,e=ce,n,s="o",i=1,r)=>{n=n||e,r=r!=null?r:Os(s,e);const o=dt(i),a=c=>o.add(c,Nt(c,t,e,n,s,"",r));return o.default(vn(t,e,n,s,r)),[o,a(2),a(3),a(4)]},Tt=(t,e,n=Cs,s,i="o",r=1,o)=>{const a=e||Es("op");s=s||n,o=o!=null?o:Os(i,n);const c=dt(r),l=f=>c.add(f,hr(f,[t],a,"op",n,s,i,"",o));return c.default(Ba([t],a,"op",n,s,i,o)),[c,l(2),l(3),l(4)]},Ua=(t,e=ce,n=Ra,s=ce,i="o",r,o=[2,3,4])=>[za(t,`${e},k,${n}`,s,i,r),...o.map(a=>Nt(a,t,`${e},${n}`,s,i,"",r!=null?r:Os(i,e),"",!0))],Ds=t=>gt($a(t)),xs=t=>gt(_a(t),Sa),[It,dr,Pa,Iu]=Ds("+"),[ku,gr,Ga,Cu]=xs("+"),J=-1/0,K=1/0,mr=Object.freeze([J,J]),pr=Object.freeze([K,K]),La=Object.freeze([1,1]),br=Object.freeze([0,0]),qa=Object.freeze([1,0]),ja=Object.freeze([0,1]);Object.freeze([J,J,J]);Object.freeze([K,K,K]);Object.freeze([1,1,1]);const Ha=Object.freeze([0,0,0]);Object.freeze([1,0,0]);Object.freeze([0,1,0]);Object.freeze([0,0,1]);Object.freeze([J,J,J,J]);Object.freeze([K,K,K,K]);Object.freeze([1,1,1,1]);Object.freeze([0,0,0,0]);Object.freeze([1,0,0,0]);Object.freeze([0,1,0,0]);Object.freeze([0,0,1,0]);Object.freeze([0,0,0,1]);const[le,yr,Va,Eu]=gt(ar("Math.max")),[nt,fe,fs,Qt]=gt(lr,"o,a",void 0,"o",1,rr),[Ou,us,Ya,Du]=xs("-"),fi=Object.getPrototypeOf,Rn=t=>{let e;return t!=null&&typeof t=="object"&&((e=fi(t))===null||fi(e)===null)},Wa=(t,e=0)=>new Array(t).fill(e),Xa=t=>{if(t.length){const e=t[t.length-1];return Rn(e)?t.pop():(e==null&&t.pop(),void 0)}},Za=t=>{const e=Xa(t);return t.length?t.length===2?[t[0],t[1],e]:[void 0,t[0],e]:[void 0,void 0,e]},j=(t,e=2)=>O(t)?Wa(e,t):t,te=t=>V(t,"copy")?t.copy():nt([],t),Ja=t=>t.map(te),R=t=>({...t.attribs}),rt=(t,e)=>new t(Ja(e.points),R(e));class ue{constructor(e=[0,0,0],n=1,s){this.pos=e,this.attribs=s,this.size=j(n,3)}get type(){return"aabb"}copy(){return new ue(fs([],this.pos),fs([],this.size),R(this))}withAttribs(e){return new ue(this.pos,this.size,e)}max(){return Pa([],this.pos,this.size)}offset(e){return Ya(null,this.pos,e),Va(null,Ga(null,this.size,e*2),Ha),this}}class ot{constructor(e=[],n){this.points=e,this.attribs=n}*[Symbol.iterator](){yield*this.points}}const ui=Object.getPrototypeOf({}),ve="function",hi="string",At=(t,e)=>{let n;if(t===e)return!0;if(t!=null){if(typeof t.equiv===ve)return t.equiv(e)}else return t==e;if(e!=null){if(typeof e.equiv===ve)return e.equiv(t)}else return t==e;return typeof t===hi||typeof e===hi?!1:(n=Object.getPrototypeOf(t),(n==null||n===ui)&&(n=Object.getPrototypeOf(e),n==null||n===ui)?ec(t,e):typeof t!==ve&&t.length!==void 0&&typeof e!==ve&&e.length!==void 0?Ka(t,e):t instanceof Set&&e instanceof Set?Qa(t,e):t instanceof Map&&e instanceof Map?tc(t,e):t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():t instanceof RegExp&&e instanceof RegExp?t.toString()===e.toString():t!==t&&e!==e)},Ka=(t,e,n=At)=>{let s=t.length;if(s===e.length)for(;s-- >0&&n(t[s],e[s]););return s<0},Qa=(t,e,n=At)=>t.size===e.size&&n([...t.keys()].sort(),[...e.keys()].sort()),tc=(t,e,n=At)=>t.size===e.size&&n([...t].sort(),[...e].sort()),ec=(t,e,n=At)=>{if(Object.keys(t).length!==Object.keys(e).length)return!1;for(let s in t)if(!e.hasOwnProperty(s)||!n(t[s],e[s]))return!1;return!0},wr=Math.PI,_=wr*2,ee=wr/2,nc=1/_;let T=1e-6;const sc=(t,e=1)=>[Math.cos(t)*e,Math.sin(t)*e],Ar=t=>(t%=_,t<0?_+t:t),ic=(t,e)=>Ar(Math.atan2(t,e)),st=(t,e,n)=>t<e?e:t>n?n:t,p=t=>t<0?0:t>1?1:t,rc=t=>t<-1?-1:t>1?1:t,Sr=(t,e,n)=>t>=e&&t<=n,[oc,D,di,xu]=Ds("*"),ac=(t,e)=>(n,s,i)=>{n?n!==s&&nt(n,s):n=s;const r=Math.sin(i),o=Math.cos(i),a=s[t],c=s[e];return n[t]=a*o-c*r,n[e]=a*r+c*o,n},Mr=ac(0,1),je=Mr,cc=(t,e,n,s,i=[])=>dr(null,Mr(null,D(i,sc(s),e),n),t),lc=Se(()=>"Assertion failed"),E=(typeof process<"u"&&process.env!==void 0?!!{}.UMBRELLA_ASSERTS:!!{}.VITE_UMBRELLA_ASSERTS)?(t,e)=>{if(typeof t=="function"&&!t()||!t)throw new lc(typeof e=="function"?e():e)}:()=>{},[Nu,fc,Tu,zu]=gt(Ia("*","+"),Ma,ce),[vr,He,uc,Bu]=xs("*");class Ve{constructor(e=[0,0],n=1,s){this.pos=e,this.r=n,this.attribs=s}get type(){return"circle"}copy(){return new Ve(nt([],this.pos),this.r,R(this))}withAttribs(e){return new Ve(this.pos,this.r,e)}toHiccup(){return["circle",this.attribs,this.pos,this.r]}}class Ye extends ot{get type(){return"cubic"}copy(){return rt(Ye,this)}withAttribs(e){return new Ye(this.points,e)}toHiccup(){return["path",this.attribs,[["M",this.points[0]],...this.toHiccupPathSegments()]]}toHiccupPathSegments(){const e=this.points;return[["C",e[1],e[2],e[3]]]}}class he{constructor(e=[0,0],n=[1,1],s){this.pos=e,this.attribs=s,this.r=j(n)}get type(){return"ellipse"}copy(){return new he(nt([],this.pos),nt([],this.r),R(this))}withAttribs(e){return new he(this.pos,this.r,e)}toHiccup(){return["ellipse",this.attribs,this.pos,this.r]}}class ne{constructor(e,n=[]){this.attribs=e,this.children=n}get type(){return"group"}*[Symbol.iterator](){yield*this.children}copy(){return this.copyTransformed(e=>e.copy())}copyTransformed(e){return new ne(R(this),this.children.map(e))}withAttribs(e){return new ne(e,this.children)}equiv(e){return e instanceof ne&&At(this.children,e.children)}toHiccup(){return["g",this.attribs,...this.children.map(e=>e.toHiccup())]}}class We extends ot{get type(){return"line"}copy(){return rt(We,this)}withAttribs(e){return new We(this.points,e)}toHiccup(){return["line",this.attribs,this.points[0],this.points[1]]}toHiccupPathSegments(){const[e,n]=this.points;return[e[0]===n[0]?["V",n[1]]:e[1]===n[1]?["H",n[0]]:["L",n]]}}const hc=Se(()=>"illegal state"),dc=t=>{throw new hc(t)};class se{constructor(e=[],n){this.segments=e,this.attribs=n,this.closed=!1}get type(){return"path"}*[Symbol.iterator](){yield*this.segments}copy(){const e=new se(this.segments.map(n=>{const s={type:n.type};return n.point&&(s.point=te(n.point)),n.geo&&(s.geo=n.geo.copy()),s}),R(this));return e.closed=this.closed,e}withAttribs(e){const n=new se(this.segments,e);return n.closed=!0,n}equiv(e){return e instanceof se&&At(this.segments,e.segments)}add(e){this.closed&&dc("path already closed"),this.segments.push(e)}toHiccup(){let e=[];const n=this.segments,s=n.length;if(s>1){for(let i=0;i<s;i++){const r=n[i];r.geo?e=e.concat(r.geo.toHiccupPathSegments()):r.point&&e.push(["M",r.point])}this.closed&&e.push(["Z"])}return["path",this.attribs||{},e]}}class kt extends ot{get type(){return"points"}copy(){return rt(kt,this)}withAttribs(e){return new kt(this.points,e)}toHiccup(){return["points",this.attribs,this.points]}}class Xe extends ot{get type(){return"points3"}copy(){return rt(Xe,this)}withAttribs(e){return new Xe(this.points,e)}toHiccup(){return["points3",this.attribs,this.points]}}class Ze extends ot{get type(){return"poly"}copy(){return rt(Ze,this)}withAttribs(e){return new Ze(this.points,e)}toHiccup(){return["polygon",this.attribs,this.points]}}class Ct extends ot{get type(){return"polyline"}copy(){return rt(Ct,this)}withAttribs(e){return new Ct(this.points,e)}toHiccup(){return["polyline",{...this.attribs,fill:"none"},this.points]}toHiccupPathSegments(){const e=[];for(let n=this.points,s=n.length,i=1;i<s;i++)e.push(["L",n[i]]);return e}}class Je extends ot{get type(){return"quad"}copy(){return rt(Je,this)}withAttribs(e){return new Je(this.points,e)}toHiccup(){return["polygon",this.attribs,this.points]}}class Ke extends ot{get type(){return"quadratic"}copy(){return rt(Ke,this)}withAttribs(e){return new Ke(this.points,e)}toHiccup(){return["path",this.attribs,[["M",this.points[0]],...this.toHiccupPathSegments()]]}toHiccupPathSegments(){const e=this.points;return[["Q",e[1],e[2]]]}}class Qe{constructor(e,n,s){this.pos=e,this.dir=n,this.attribs=s}get type(){return"ray"}copy(){return new Qe(nt([],this.pos),nt([],this.dir),R(this))}withAttribs(e){return new Qe(this.pos,this.dir,e)}toHiccup(){return["line",this.attribs,this.pos,fc([],this.dir,1e6,this.pos)]}}class G{constructor(e=[0,0],n=1,s){this.pos=e,this.attribs=s,this.size=j(n)}get type(){return"rect"}copy(){return new G(fe([],this.pos),fe([],this.size),R(this))}withAttribs(e){return new G(this.pos,this.size,e)}max(){return dr([],this.pos,this.size)}offset(e){return us(null,this.pos,e),yr(null,gr(null,this.size,e*2),br),this}toHiccup(){return["rect",this.attribs,this.pos,this.size[0],this.size[1]]}}class tn{constructor(e=[0,0,0],n=1,s){this.pos=e,this.r=n,this.attribs=s}get type(){return"sphere"}copy(){return new tn(fs([],this.pos),this.r,R(this))}withAttribs(e){return new tn(this.pos,this.r,e)}toHiccup(){return["sphere",this.attribs,this.pos,this.r]}}class en{constructor(e,n,s){this.pos=e,this.body=n,this.attribs=s}get type(){return"text"}copy(){return new en(nt([],this.pos),this.body,R(this))}withAttribs(e){return new en(this.pos,this.body,e)}toHiccup(){return["text",this.attribs,this.pos,this.body]}}class nn extends ot{get type(){return"tri"}copy(){return rt(nn,this)}withAttribs(e){return new nn(this.points,e)}toHiccup(){return["polygon",this.attribs,this.points]}}const[de,gc,Uu,Pu]=gt(ar("Math.min")),[sn,Rr,mc,Gu]=Ds("-"),pc=(t,e,n)=>new ue(t,mc([],e,t),n),bc=(t,e,n,s)=>pc(t,e,s).offset(n),U=(t,e,n,s)=>(!t&&(t=[]),t[0]=e,t[1]=n,t[2]=s,t),v=(t,e,n,s,i)=>(!t&&(t=[]),t[0]=e,t[1]=n,t[2]=s,t[3]=i,t),Ns=t=>Ts.add(t,Nt(t,cr,"a,b",void 0,"","+","return ",";")),Ts=dt();Ts.default(vn(Ca,"a,b",void 0,"s","let s=0;"));Ns(2);const Fr=Ns(3);Ns(4);const zs=t=>Fn.add(t,Nt(t,([e])=>`${e}*${e}`,"a","a","","+","return ",";")),Fn=dt();Fn.default(vn(([t])=>`sum+=${t}*${t};`,"a",void 0,"sum","let sum=0;"));const yc=zs(2);zs(3);zs(4);const Bs=t=>Math.sqrt(Fn(t)),wc=Math.abs,Et=(t,e,n=T)=>wc(t-e)<=n,Us=t=>Ps.add(t,hr(t,[Et,T],([e,n])=>`eq(${e},${n},eps)`,"eq,_eps","a,b,eps=_eps","a,b","","&&","return a.length === b.length && ",";")),Ps=dt();Ps.default((t,e,n=T)=>V(t,"eqDelta")?t.eqDelta(e,n):V(e,"eqDelta")?e.eqDelta(t,n):Sc(t,e,t.length,n));const Ac=Us(2);Us(3);const $r=Us(4),Sc=(t,e,n,s=T,i=0,r=0,o=1,a=1)=>{for(;n>0;n--,i+=o,r+=a)if(!Et(t[i],e[r],s))return!1;return!0},Mc=(t,e,n=T)=>{for(let s=e.length;s-- >0;)if(Ps(t,e[s],n))return!0;return!1};function*vc(t,e,n,s,i,r){for(;n-- >0;)yield new t(e,s,i),s+=r}function*_r(t,e,n,s){for(;e-- >0;)yield t[n],n+=s}const Gs=(t,e,n,s=!0,i=!0)=>{const r=n>0?s?function(){return this.buf[this.offset+n*this.stride]}:function(){return this.buf[this.offset+n]}:function(){return this.buf[this.offset]},o=n>0?s?function(a){this.buf[this.offset+n*this.stride]=a}:function(a){this.buf[this.offset+n]=a}:function(a){this.buf[this.offset]=a};i&&Object.defineProperty(t,n,{get:r,set:o,enumerable:!0}),Object.defineProperty(t,e,{get:r,set:o,enumerable:!0})},Ir=(t,e,n,s)=>e.forEach((i,r)=>Gs(t,i,r,n,s)),Ls=xt((t,e=!1)=>e?n=>kr(n)||n.toFixed(t):n=>n.toFixed(t)),Rc=xt((t,e=3)=>{const n=t-e-1,s=Math.pow(10,n),i=-Math.pow(10,n-1),r=Math.pow(10,-(e-1)),o=pn(t);return a=>{const c=Math.abs(a);return o(kr(a)||(a===0?"0":c<r||c>=s?Fc(a,t):a.toFixed(e-(a<i?1:0))))}}),Fc=(t,e)=>t.toExponential(Math.max(e-4-(Math.log(Math.abs(t))/Math.LN10>=10?2:1)-(t<0?1:0),0)),kr=t=>isNaN(t)?"NaN":t===1/0?"+\u221E":t===-1/0?"-\u221E":void 0,$c=t=>{const{prec:e,width:n,delim:s,wrap:i}={prec:3,delim:", ",wrap:"[]",...t},r=n?Rc(n,e):Ls(e);return o=>{let a=[];for(let c of o)a.push(r(c));return`${i[0]}${a.join(s)}${i[1]}`}};let _c=$c();class Ic{constructor(e,n=0,s=1){this.buf=e,this.offset=n,this.stride=s}toString(){return _c(this)}}var k;(function(t){t[t.I8=5120]="I8",t[t.U8=5121]="U8",t[t.I16=5122]="I16",t[t.U16=5123]="U16",t[t.I32=5124]="I32",t[t.U32=5125]="U32",t[t.F32=5126]="F32"})(k||(k={}));const kc={[k.I8]:"i8",[k.U8]:"u8",[k.I16]:"i16",[k.U16]:"u16",[k.I32]:"i32",[k.U32]:"u32",[k.F32]:"f32"};k.I8,k.U8,k.U8,k.I16,k.U16,k.I32,k.U32,k.F32;const Cc={f32:Float32Array,f64:Float64Array},Ec={i8:Int8Array,i16:Int16Array,i32:Int32Array},Oc={u8:Uint8Array,u8c:Uint8ClampedArray,u16:Uint16Array,u32:Uint32Array},Dc={i64:BigInt64Array,u64:BigUint64Array},xc={...Cc,...Ec,...Oc},Nc=t=>{const e=kc[t];return e!==void 0?e:t};function hs(t,...e){const n=Dc[t];return new(n||xc[Nc(t)])(...e)}const Tc=t=>t>16?"u32":t>8?"u16":"u8",qs=(t,e,n,s,i,r)=>{const o=[];for(;n-- >0;)o.push(new t(e,s,i)),s+=r;return o},zc=(t,e,n,s,i,r)=>{for(let o of n)t(e,o,s,0,i,1),s+=r;return e},$n=new Float64Array(1),Bc=new Float32Array($n.buffer);new Int32Array($n.buffer);const Cr=new Uint32Array($n.buffer);$n[0]=2,Cr[1];const Uc=t=>(Bc[0]=t,Cr[0]),gi=(t,e)=>(t<<e|t>>>32-e)>>>0,Pc=(t,e=2654435761)=>{let n=-1;for(let s=t.length;s-- >0;)n=Math.imul(e,n)+jc(n,Uc(t[s]))>>>0;return n},Gc=3432918353,Lc=461845907,qc=3864292196,jc=(t,e)=>(e=Math.imul(gi(Math.imul(e,Gc)>>>0,15),Lc)>>>0,(Math.imul(gi(t^e,13),5)>>>0)+qc>>>0),[Lu,Hc,qu,ju]=Ua(lr,"o,a",ir,"o,a","o",rr);class S extends Ic{constructor(e,n=0,s=1){super(e||[0,0],n,s)}static mapBuffer(e,n=e.length>>1,s=0,i=1,r=2){return qs(S,e,n,s,i,r)}static intoBuffer(e,n,s=0,i=1,r=2){return zc(Hc,e,n,s,i,r)}static iterator(e,n,s=0,i=1,r=2){return vc(S,e,n,s,i,r)}[Symbol.iterator](){return _r(this.buf,2,this.offset,this.stride)}get length(){return 2}copy(){return new S([this.x,this.y])}copyView(){return new S(this.buf,this.offset,this.stride)}empty(){return new S}eqDelta(e,n=T){return Ac(this,e,n)}hash(){return Pc(this)}toJSON(){return[this.x,this.y]}}S.X_AXIS=new S(qa);S.Y_AXIS=new S(ja);S.MIN=new S(mr);S.MAX=new S(pr);S.ZERO=new S(br);S.ONE=new S(La);Ir(S.prototype,["x","y"]);const Vc=(t=0,e=0)=>new S([t,e]),Er=(t,e,n=1)=>{!t&&(t=e);const s=Bs(e);return s>=T?vr(t,e,n/s):t!==e?nt(t,e):t},Yc=(t,e,n=1)=>{!t&&(t=e);const s=Math.sqrt(yc(e));return s>=T?He(t,e,n/s):t!==e?fe(t,e):t},[Wc,Hu,Vu,Xc]=gt(Oa,va),[Yu,Wu,Xu,Zc]=Tt(st,ka(),sr);Tt(p,Es(),Cs);Tt(rc,Es(),Cs);const Jc=(t,e=T)=>t>e?1:t<-e?-1:0,Te=(t,e,n)=>{const s=t[0],i=t[1];return(e[0]-s)*(n[1]-i)-(n[0]-s)*(e[1]-i)},Kc=(t,e,n,s=T)=>Jc(Te(t,e,n),s),Qc=(t,e,n,s=T)=>Kc(t,e,n,s)<0,Or=([t,e])=>`t=${t}-${e};s+=t*t;`,Dr="let t,s=0;",js=t=>_n.add(t,Nt(t,Or,"a,b",void 0,"s","",Dr)),_n=dt();_n.default(vn(Or,"a,b",void 0,"s",Dr));js(2);js(3);js(4);const Hs=t=>Nt(t,cr,`o,a,${ir}`,"o,a","","+","return ",";",!0);Hs(2);const qn=Hs(3),Re=Hs(4),rn=(t,e)=>t-e*Math.floor(t/e),M=t=>t-Math.floor(t),mi=(t,e=1)=>Math.round(t/e)*e,pi=1/2**32;class xr{float(e=1){return this.int()*pi*e}norm(e=1){return(this.int()*pi-.5)*2*e}minmax(e,n){return this.float()*(n-e)+e}minmaxInt(e,n){return e|=0,n|=0,e+(this.float()*(n-e)|0)}}const jn=Math.random;class tl extends xr{int(){return jn()*4294967296>>>0}float(e=1){return jn()*e}norm(e=1){return(jn()-.5)*2*e}}const z=new tl,el=(t=z,e=0,n=1)=>{let s,i,r;return()=>{if(s!=null)i=s,s=null;else do s=t.norm(),i=t.norm(),r=s*s+i*i;while(r>1||r===0);return e+n*i*Math.sqrt(-2*Math.log(r)/r)}};Tt(z,([t])=>`${t}=rnd.minmax(n,m);`,"a,n=-1,m=1,rnd=op","a","a",0,or);Tt(el,([t])=>`${t}=rnd()*n;`,"a,rnd=op(),n=1","a","a",0,or);const[Nr,Zu,Ju,Ku]=Tt(z,([t,e,n])=>`${t}=rnd.minmax(${e},${n});`,"o,a,b,rnd=op","o,a,b"),on=(t,e,n)=>t+(e-t)*n,Tr=(t,e,n,s,i,r)=>{const o=1-i,a=1-r;return t*o*a+e*i*a+n*o*r+s*i*r},nl=(t,e,n,s,i)=>{const r=i*i,o=1-i,a=o*o;return t*a*o+e*3*a*i+n*3*r*o+s*r*i},Lt=(t,e,n,s,i)=>{s*=.5;const r=-.5*t+1.5*e-1.5*n+s,o=t-2.5*e+2*n-s,a=-.5*t+.5*n,c=e,l=i*i;return i*l*r+l*o+i*a+c},zr=(t,e,n,s,i,r,o,a,c,l,f,h,u,g,d,m,b,w)=>Lt(Lt(t,e,n,s,b),Lt(i,r,o,a,b),Lt(c,l,f,h,b),Lt(u,g,d,m,b),w),[sl,Qu,th,eh]=gt(Ea,sr),bi=(t,e)=>e!==0?t/e:0,an=(t={},e)=>new ne(t,e);var ds;(function(t){t[t.FINE=0]="FINE",t[t.DEBUG=1]="DEBUG",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.SEVERE=4]="SEVERE",t[t.NONE=5]="NONE"})(ds||(ds={}));const il=Object.freeze({level:ds.NONE,fine(){},debug(){},info(){},warn(){},severe(){}});let rl=il;const N=Symbol();function at(t,e,n){const s={},i=e?ol(e):{},r=(...o)=>{const a=t(...o),c=s[a]||ze(s,i,a)||s[N];return c?c(...o):Me(`missing implementation for: "${a.toString()}"`)};return r.add=(o,a)=>(s[o]&&rl.warn(`overwriting '${o.toString()}' impl`),s[o]=a,!0),r.addAll=o=>{let a=!0;for(let c in o)a=r.add(c,o[c])&&a;return N in o&&r.setDefault(o[N]),a},r.setDefault=o=>r.add(N,o),r.remove=o=>s[o]?(delete s[o],!0):!1,r.callable=(...o)=>{const a=t(...o);return!!(s[a]||ze(s,i,a)||s[N])},r.isa=(o,a)=>{let c=i[o];!c&&(i[o]=c=new Set),c.add(a)},r.impls=()=>{const o=new Set(Object.keys(s));for(let a in i)ze(s,i,a)&&o.add(a);return s[N]&&o.add(N),o},r.rels=()=>i,r.parents=o=>i[o],r.ancestors=o=>new Set(Br([],i,o)),r.dependencies=function*(){for(let o in i)for(let a of i[o])yield[o,a];for(let o in s)!i[o]&&(yield[o,void 0])},n&&r.addAll(n),r}const ze=(t,e,n)=>{const s=e[n];if(!!s)for(let i of s){let r=t[i]||ze(t,e,i);if(r)return r}},Br=(t,e,n)=>{const s=e[n];if(s)for(let i of s)t.push(i),Br(t,e,i);return t},ol=t=>{const e={};for(let n in t){const s=t[n];e[n]=s instanceof Set?s:Array.isArray(s)?new Set(s):new Set([s])}return e},Vs=t=>t.type,mt=Array.isArray,al=(t,e,n)=>{const s=sn([],n,e),i=Fn(s);return i>1e-6?Ts(sn([],t,e),s)/i:void 0},gs=t=>t[t.length-1];function*Ur(t,e=!0){if(t>0)for(let n=0,s=e?t+1:t;n<s;n++)yield n/t}const cl=Se(()=>"illegal argument(s)"),ht=t=>{throw new cl(t)};function cn(...t){return new G(...Za(t))}const yt=(t,e,n)=>new G(t,Rr([],e,t),n),qt=(t,e,n,s)=>yt(t,e,s).offset(n),ll=(t,e)=>t.map(O(e)?n=>vr([],n,e):n=>oc([],n,e)),Z=t=>(e,n)=>new t(ll(e.points,n),R(e)),ge=at(Vs,{},{aabb:(t,e)=>(e=j(e,3),new ue(di([],t.pos,e),di([],t.size,e),R(t))),arc:(t,e)=>{e=j(e);const n=t.copy();return D(null,n.pos,e),D(null,n.r,e),n},circle:(t,e)=>O(e)?new Ve(He([],t.pos,e),t.r*e,R(t)):new he(D([],t.pos,e),He([],e,t.r),R(t)),cubic:Z(Ye),ellipse:(t,e)=>(e=j(e),new he(D([],t.pos,e),D([],t.r,e),R(t))),group:(t,e)=>t.copyTransformed(n=>ge(n,e)),line:Z(We),path:(t,e)=>(e=j(e),new se(t.segments.map(n=>n.geo?{type:n.type,geo:ge(n.geo,e)}:{type:n.type,point:D([],n.point,e)}),R(t))),points:Z(kt),points3:Z(Xe),poly:Z(Ze),polyline:Z(Ct),quad:Z(Je),quadratic:Z(Ke),ray:(t,e)=>(e=j(e),new Qe(D([],t.pos,e),Yc(null,D([],t.dir,e)),R(t))),rect:(t,e)=>(e=j(e),new G(D([],t.pos,e),D([],t.size,e),R(t))),sphere:(t,e)=>O(e)?new tn(uc([],t.pos,e),t.r*e,R(t)):Me("can't non-uniformly scale sphere"),text:(t,e)=>new en(D([],t.pos,j(e)),t.body,R(t)),tri:Z(nn)}),ie={},yi=(t,e)=>{for(let n in e){const s=e[n];if(mt(s)){const[i,r,o,a]=s;e[n]=s.length===2?(c,l)=>r(c,i(c,l)):s.length===3?(c,l)=>o(c,r(c,i(c,l))):(c,l)=>a(c,o(c,r(c,i(c,l))))}}ie[t]={...ie[t],...e}},Pr=(t,e,n,s)=>{const i=ie[n];E(!!i,`no conversions available for ${n}`);let r=i[s];return r?r(t,e):ie.rgb[s]?i.rgb(t,ie.rgb[s]([],e)):Me(`can't convert: ${s} -> ${n}`)},fl=(t=0)=>e=>(e*100).toFixed(t)+"%";Object.freeze([0,0,0,1]);Object.freeze([1,1,1,1]);Object.freeze([1,0,0,1]);Object.freeze([0,1,0,1]);Object.freeze([0,0,1,1]);Object.freeze([0,1,1,1]);Object.freeze([1,0,1,1]);Object.freeze([1,1,0,1]);const ul=[.299,.587,.114],Gr=[.2126,.7152,.0722],hl=[.4360747,.2225045,.0139322,.3850649,.7168786,.0971045,.1430804,.0606169,.7141733],dl=[3.1338561,-.9787684,.0719453,-1.6168667,1.9161415,-.2289914,-.4906146,.033454,1.4052427],gl=[3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252],ml=[1.0478112,.0295424,-.0092345,.0228866,.9904844,.0150436,-.050127,-.0170491,.7521316],Lr=[.96422,1,.82521],pl=[.95047,1,1.08883];let ln=Ls(3),wi=fl(3);const Q=1/255,W=1/256,F=(t,e=1)=>t!=null?p(t):e,bl=t=>{if(typeof t[0]=="number")switch(t.length){case 1:return t.push(0,0,1),[t];case 2:return t.push(0,1),[t];case 3:return t.push(1),[t];default:return[t]}return t},qr=t=>{const e=ln(M(t[0])*360),n=wi(p(t[1])),s=wi(p(t[2])),i=F(t[3]);return i<1?`hsla(${e},${n},${s},${ln(i)})`:`hsl(${e},${n},${s})`},ms=(t,e,n=1)=>v(t||e,p(e[0]),p(e[1]),p(e[2]),F(e[3],n)),Ys=(t,e,n=1)=>v(t||e,M(e[0]),p(e[1]),p(e[2]),F(e[3],n)),yl=(t,e)=>{t=Ys(t||e,e);const n=t[1],s=t[2],i=(2-n)*s/2;return t[2]=i,t[1]=i&&i<1?n*s/(i<.5?i*2:2-i*2):n,t},wl=t=>qr(yl([],t)),Ai="0123456789abcdef",fn=t=>Ai[t>>>4&15]+Ai[t&15],Al=t=>fn(t>>>8)+fn(t&255),Sl=t=>fn(t>>>16)+Al(t);const Ws=xt((t,e,n="")=>{const s=Xi("0",e);return i=>(i=(i>>>0).toString(t),n+(i.length<e?s.substring(i.length)+i:i))});Ws(2,8);Ws(2,16);Ws(2,32);const jr=Sl,ps=t=>{const e=t>>>24;return e<255?`rgba(${t>>16&255},${t>>8&255},${t&255},${ln(e*Q)})`:`#${jr(t&16777215)}`},un=t=>(t&255)<<16|t>>16&255|t&4278255360,Ml=un,vl=un,jt=(t,e)=>{const{1:n,2:s}=e;return v(t||e,e[0],Math.hypot(n,s),n===0&&s===0?0:ic(s,n)*nc,F(e[3]))},In=(t,e)=>{let{1:n,2:s}=e;s*=_;const i=F(e[3]);return n>0?v(t||e,e[0],Math.cos(s)*n,Math.sin(s)*n,i):v(t||e,e[0],0,0,i)},Hn=t=>{const e=t**3;return e>.008856?e:(t-16/116)/7.787},Hr=(t,e,n=Lr)=>{const s=(e[0]+.16)/1.16;return v(t||e,Hn(e[1]/5+s)*n[0],Hn(s)*n[1],Hn(s-e[2]/2)*n[2],F(e[3]))},Vr=(t,e)=>Hr(t,e,pl),kn=(t,e,n,s=!1)=>{const i=qn(e,n,0,0,3),r=qn(e,n,1,0,3),o=qn(e,n,2,0,3),a=F(n[3]);return s?v(t||n,p(i),p(r),p(o),a):v(t||n,i,r,o,a)},Rl=(t,e,n,s=!0)=>{t=v(t||n,n[0],n[1],n[2],F(n[3]));const i=Re(t,e,0,0)+e[4],r=Re(t,e,0,5)+e[9],o=Re(t,e,0,10)+e[14],a=Re(t,e,0,15)+e[19];return s?v(t,p(i),p(r),p(o),p(a)):v(t,i,r,o,a)},Xs=(t,e,n=dl)=>kn(t,n,e),bs=(t,e)=>Xs(t,e,gl),Ot=(t,e)=>Xs(null,Hr(t,e)),Yr=(t,e)=>bs(null,Vr(t,e)),Vn=t=>t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055,Yn=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4),re=(t,e)=>v(t||e,Vn(e[0]),Vn(e[1]),Vn(e[2]),F(e[3])),H=(t,e=0)=>(t<0?0:t>1?1:t)*255+.5<<e,vt=t=>{const e=H(t[0]),n=H(t[1]),s=H(t[2]),i=F(t[3]);return i<1?`rgba(${e},${n},${s},${ln(i)})`:`#${jr(e<<16|n<<8|s)}`},Fl=t=>vt(re([],t)),Si={abgr32:t=>ps(vl(t[0])),argb32:t=>ps(t[0]),hsl:qr,hsv:wl,lab50:t=>vt(re(null,Ot([],t))),lab65:t=>vt(re(null,Yr([],t))),lch:t=>vt(re(null,Ot(null,In([],t)))),rgb:Fl,srgb:vt},me=t=>{let e;return I(t)?t:O(t)?ps(t):t.mode?(e=Si[t.mode])?e(t):Si.rgb(Pr([],t,"rgb",t.mode)):vt(t)},$l=(t,e,n,s,i)=>{const r=fe([],pr),o=fe([],mr),a=[],c=l=>{cc(t,e,n,l,a),gc(null,r,a),yr(null,o,a)};if(c(s),c(i),s>i){const l=s;s=i,i=l}for(let l=mi(s,ee),f=mi(i,ee);l<f;l+=ee)Sr(l,s,i)&&c(l);return[r,o]},Wr=(t,e,n)=>{for(let s=t.length;s-- >0;){const i=t[s];de(null,e,i),le(null,n,i)}return[e,n]},_l=t=>Wr(t,[1/0,1/0],[-1/0,-1/0]),Il=t=>Wr(t,[1/0,1/0,1/0],[-1/0,-1/0,-1/0]),kl=(t,e,n,s,i,r,o)=>{t[n]=Math.min(s,o),e[n]=Math.max(s,o);const a=-s+i,c=s-2*i+r,l=-s+3*i-3*r+o;let f=c*c-a*l;if(f>0){f=Math.sqrt(f);const h=u=>{if(u>0&&u<1){const g=nl(s,i,r,o,u);t[n]=Math.min(t[n],g),e[n]=Math.max(e[n],g)}};h(a/(-c-f)),h(a/(-c+f))}},Cl=(t,e,n,s)=>{const i=[],r=[];for(let o=t.length;o-- >0;)kl(i,r,o,t[o],e[o],n[o],s[o]);return[i,r]},El=(t,e,n)=>{const s=p((t-e)/(t-2*e+n)),i=1-s;return i*i*t+2*i*s*e+s*s*n},Ol=(t,e,n)=>{for(let s=t.length;s-- >0;)if(!Sr(t[s],e[s],n[s]))return!1;return!0},Dl=(t,e,n)=>{const s=de([],t,n),i=le([],t,n);if(!Ol(e,s,i)){const r=[];for(let o=t.length;o-- >0;)r[o]=El(t[o],e[o],n[o]);de(null,s,r),le(null,i,r)}return[s,i]};function Xr(t,e){return yn(e)?Sn(Xr(t),e):n=>{const s=n[2];return wn(n,(i,r)=>t(r)?s(i,r):i)}}const Mi=(t,e)=>{let n=t.length-1;if(n<0)return;let s=e(t[n]);if(!s)return;let{pos:i,size:r}=s;for(;n-- >0;)s=e(t[n]),s&&([i,r]=xl(i,r,s.pos,s.size));return[i,r]},xl=(t,e,n,s)=>{const i=It([],t,e),r=It([],n,s),o=de([],t,n);return[o,sn(null,le(null,i,r),o)]},ys=at(Vs,{aabb:"rect",bpatch:"points",poly:"points",polyline:"points",quad:"points",tri:"points"},{arc:(t,e=0)=>qt(...$l(t.pos,t.r,t.axis,t.start,t.end),e),circle:(t,e=0)=>new G(us([],t.pos,t.r+e),He(null,[2,2],t.r+e)),cubic:({points:t},e=0)=>qt(...Cl(t[0],t[1],t[2],t[3]),e),ellipse:(t,e=0)=>{const n=gr([],t.r,e);return new G(Rr([],t.pos,n),D(null,[2,2],n))},group:(t,e=0)=>{const n=Mi(t.children,ys);return n?new G(...n).offset(e):void 0},line:({points:[t,e]},n=0)=>qt(de([],t,e),le([],t,e),n),path:(t,e=0)=>{const n=Mi([...Sn(Is(Y(s=>s.geo),Xr(s=>!!s)),t.segments)],ys);return n?new G(...n).offset(e):void 0},points:(t,e=0)=>qt(..._l(t.points),e),points3:(t,e=0)=>bc(...Il(t.points),e),quadratic:({points:t},e=0)=>qt(...Dl(t[0],t[1],t[2]),e),rect:(t,e=0)=>e===0?t.copy():t.copy().offset(e),text:(t,e=0)=>new G(us([],t.pos,e),e*2)}),Nl=(t,e,n,s=T)=>{const i=al(t,e,n);return i!==void 0?_n(t,Wc([],e,n,p(i)))<s*s:!1},Tl=(t,e,n)=>_n(e,t)<=n*n,zl=(t,e,n,s)=>{const i=Qc(e,n,s)?1:-1;return i*Te(e,s,t)>=0&&i*Te(n,e,t)>=0&&i*Te(s,n,t)>=0},Bl=(t,e)=>{const n=e.length-1,s=t[0],i=t[1];let r=e[n],o=e[0],a=0;for(let c=0;c<=n;r=o,o=e[++c])a=Ul(s,i,r[0],r[1],o[0],o[1],a);return a},Ul=(t,e,n,s,i,r,o)=>(s<e&&r>=e||r<e&&s>=e)&&(n<=t||i<=t)?o^~~(n+(e-s)/(r-s)*(i-n)<t):o,Zs=dt(0),Pl=Zs.add(2,([t,e],n,s)=>t>=n[0]&&t<=n[0]+s[0]&&e>=n[1]&&e<=n[1]+s[1]),Gl=Zs.add(3,([t,e,n],s,i)=>t>=s[0]&&t<=s[0]+i[0]&&e>=s[1]&&e<=s[1]+i[1]&&n>=s[2]&&n<=s[2]+i[2]);Zs.default((t,e,n)=>{for(let s=t.length;s-- >0;){const i=t[s],r=e[s];if(i<r||i>r+n[s])return!1}return!0});const Js=dt(0);Js.add(2,([t,e],n,s)=>t>=n[0]-s[0]&&t<=n[0]+s[0]&&e>=n[1]-s[1]&&e<=n[1]+s[1]);Js.add(3,([t,e,n],s,i)=>t>=s[0]-i[0]&&t<=s[0]+i[0]&&e>=s[1]-i[1]&&e<=s[1]+i[1]&&n>=s[2]-i[2]&&n<=s[2]+i[2]);Js.default((t,e,n)=>{for(let s=t.length;s-- >0;){const i=t[s],r=e[s],o=n[s];if(i<r-o||i>r+o)return!1}return!0});const hn=at(Vs,{points3:"points",quad:"poly",sphere:"circle"},{aabb:(t,e)=>Gl(e,t.pos,t.size),circle:(t,e)=>Tl(e,t.pos,t.r),line:(t,e)=>Nl(e,t.points[0],t.points[1]),points:({points:t},e)=>Mc(e,t),poly:(t,e)=>Bl(e,t.points)>0,rect:(t,e)=>Pl(e,t.pos,t.size),tri:(t,e)=>zl(e,...t.points)}),vi=(t,e,n=z,s=[])=>{const i=ys(t);if(!i)return;const r=i.pos,o=i.max();for(;e-- >0;)for(;;){const a=Nr([],r,o,n);if(hn(t,a)){s.push(a);break}}return s};function*Ll(t,e=1/0){for(;e-- >0;)yield t}const Cn=(t,e)=>{let n;(n=e.fill)&&n!=="none"&&t.fill(),(n=e.stroke)&&n!=="none"&&t.stroke(),(n=e.clip)&&t.clip(n===!0?"nonzero":n)},Ri=(t,e,n,s,i=0,r=_,o=!1)=>{t.beginPath(),t.arc(n[0],n[1],s,i,r,o),Cn(t,e)},ql=(t,e,n,s,i=0,r=0,o=_,a=!1)=>{t.beginPath(),t.ellipse(n[0],n[1],s[0],s[1],i,r,o,a),Cn(t,e)},Ks=me,jl=(t,e)=>I(e)?e[0]==="$"?t.grads[e.substring(1)]:e:Ks(e),Hl=(t,{from:e,to:n},s)=>{const i=t.createLinearGradient(e[0],e[1],n[0],n[1]);for(let r of s)i.addColorStop(r[0],Ks(r[1]));return i},Vl=(t,{from:e,to:n,r1:s,r2:i},r)=>{const o=t.createRadialGradient(e[0],e[1],s,n[0],n[1],i);for(let a of r)o.addColorStop(a[0],Ks(a[1]));return o},Yl=(t,e,{width:n,height:s},i,r,o,a)=>{if(V(i,"toImageData")&&(i=i.toImageData()),i instanceof ImageData){t.putImageData(i,r[0],r[1]);return}n=n||i.width,s=s||i.height,o?t.drawImage(i,o[0],o[1],a?a[0]:n,a?a[1]:s,r[0],r[1],n,s):t.drawImage(i,r[0],r[1],n,s)},Wl={align:"left",alpha:1,baseline:"alphabetic",compose:"source-over",dash:[],dashOffset:0,direction:"inherit",fill:"#000",filter:"none",font:"10px sans-serif",lineCap:"butt",lineJoin:"miter",miterLimit:10,shadowBlur:0,shadowColor:"rgba(0,0,0,0)",shadowX:0,shadowY:0,smooth:!0,stroke:"#000",weight:1},Zr={align:"textAlign",alpha:"globalAlpha",baseline:"textBaseline",clip:"clip",compose:"globalCompositeOperation",dash:"setLineDash",dashOffset:"lineDashOffset",direction:"direction",fill:"fillStyle",filter:"filter",font:"font",lineCap:"lineCap",lineJoin:"lineJoin",miterLimit:"miterLimit",shadowBlur:"shadowBlur",shadowColor:"shadowColor",shadowX:"shadowOffsetX",shadowY:"shadowOffsetY",smooth:"imageSmoothingEnabled",stroke:"strokeStyle",weight:"lineWidth"},Fi=(t,e=!1)=>({attribs:{...t.attribs},grads:{...t.grads},edits:[],restore:e}),Xl=(t,e,n)=>{let s;if(!!n){Jl(t,n)&&(s=Fi(e,!0));for(let i in n){const r=Zr[i];if(r){const o=n[i];o!=null&&e.attribs[i]!==o&&(!s&&(s=Fi(e)),s.attribs[i]=o,s.edits.push(i),Jr(t,e,i,r,o))}}return s}},Zl=(t,e,n)=>{if(n.restore){t.restore();return}const s=n.edits,i=e.attribs;for(let r=s.length;r-- >0;){const o=s[r],a=i[o];Jr(t,e,o,Zr[o],a!=null?a:Wl[o])}},$i=(t,e,n)=>{!t.grads&&(t.grads={}),t.grads[e]=n},Jr=(t,e,n,s,i)=>{switch(n){case"fill":case"stroke":case"shadowColor":t[s]=jl(e,i);break;case"dash":t[s].call(t,i);break;case"clip":break;default:t[s]=i}},Jl=(t,e)=>{let n;return(n=e.transform)||e.setTransform||e.translate||e.scale||e.rotate?(t.save(),n?t.transform(n[0],n[1],n[2],n[3],n[4],n[5]):(n=e.setTransform)?t.setTransform(n[0],n[1],n[2],n[3],n[4],n[5]):((n=e.translate)&&t.translate(n[0],n[1]),(n=e.rotate)&&t.rotate(n),(n=e.scale)&&(An(n)?t.scale(n[0],n[1]):t.scale(n,n))),!0):!1},Wn=(t,e,n,s)=>{e.stroke!=="none"&&(t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(s[0],s[1]),t.stroke())},Kl=(t,e,n)=>{if(e.stroke!=="none"){t.beginPath();for(let{0:s,1:i}of n)t.moveTo(s[0],s[1]),t.lineTo(i[0],i[1]);t.stroke()}},Ql=(t,e,n,s)=>{let i;(i=e.fill)&&i!=="none"&&_i(t,n,s,"fill","fillRect"),(i=e.stroke)&&i!=="none"&&_i(t,n,s,"stroke","strokeRect")},_i=(t,e,n,s,i)=>{const{start:r,cstride:o,estride:a,size:c}={start:0,cstride:1,estride:2,size:1,...e};let l=e&&e.num!=null?e.num:(n.length-r)/a|0;if(e.shape==="circle")for(let f=r;l-- >0;f+=a)t.beginPath(),t.arc(n[f],n[f+o],c,0,_),t[s]();else{const f=c/2;for(let h=r;l-- >0;h+=a)t[i](n[h]-f,n[h+o]-f,c,c)}},Kr=(t,e,n)=>{t.beginPath();let s=[0,0];for(let i=0,r=n.length;i<r;i++){const o=n[i];let a=o[1],c,l;switch(o[0]){case"m":a=[s[0]+a[0],s[1]+a[1]];case"M":t.moveTo(a[0],a[1]),s=a;break;case"l":a=[s[0]+a[0],s[1]+a[1]];case"L":t.lineTo(a[0],a[1]),s=a;break;case"h":a=[s[0]+a,s[1]],t.lineTo(a[0],a[1]),s=a;break;case"H":a=[a,s[1]],t.lineTo(a[0],a[1]),s=a;break;case"v":a=[s[0],s[1]+a],t.lineTo(a[0],a[1]),s=a;break;case"V":a=[s[0],a],t.lineTo(a[0],a[1]),s=a;break;case"c":c=o[2],l=o[3],l=[s[0]+l[0],s[1]+l[1]],t.bezierCurveTo(s[0]+a[0],s[1]+a[1],s[0]+c[0],s[1]+c[1],l[0],l[1]),s=l;break;case"C":c=o[2],l=o[3],t.bezierCurveTo(a[0],a[1],c[0],c[1],l[0],l[1]),s=l;break;case"q":c=o[2],c=[s[0]+c[0],s[1]+c[1]],t.quadraticCurveTo(s[0]+a[0],s[1]+a[1],c[0],c[1]),s=c;break;case"Q":c=o[2],t.quadraticCurveTo(a[0],a[1],c[0],c[1]),s=c;break;case"a":c=o[2],c=[s[0]+c[0],s[1]+c[1]],t.arcTo(s[0]+a[0],s[1]+a[1],c[0],c[1],o[3]),s=c;break;case"A":c=o[2],t.arcTo(a[0],a[1],c[0],c[1],o[3]),s=c;break;case"z":case"Z":t.closePath()}}Cn(t,e)},t0=(t,e,n,s)=>{let i;(i=e.fill)&&i!=="none"&&Ii(t,n,s,"fill","fillRect"),(i=e.stroke)&&i!=="none"&&Ii(t,n,s,"stroke","strokeRect")},Ii=(t,e,n,s,i)=>{const r=e&&e.size||1;if(e.shape==="circle")for(let o of n)t.beginPath(),t.arc(o[0],o[1],r,0,_),t[s]();else{const o=r/2;for(let a of n)t[i](a[0]-o,a[1]-o,r,r)}},e0=(t,e,n)=>{n.length<2||(Qr(t,n),t.closePath(),Cn(t,e))},Qr=(t,e)=>{let n=e[0];t.beginPath(),t.moveTo(n[0],n[1]);for(let s=1,i=e.length;s<i;s++)n=e[s],t.lineTo(n[0],n[1])},n0=(t,e,n)=>{n.length<2||e.stroke=="none"||(Qr(t,n),t.stroke())},s0=(t,e,n,s,i,r=0)=>{let o;if(r>0)return r=Math.min(Math.min(s,i)/2,r),s-=2*r,i-=2*r,Kr(t,e,[["M",[n[0]+r,n[1]]],["h",s],["a",[r,0],[r,r],r],["v",i],["a",[0,r],[-r,r],r],["h",-s],["a",[-r,0],[-r,-r],r],["v",-i],["a",[0,-r],[r,-r],r]]);(o=e.fill)&&o!=="none"&&t.fillRect(n[0],n[1],s,i),(o=e.stroke)&&o!=="none"&&t.strokeRect(n[0],n[1],s,i)},i0=(t,e,n,s,i)=>{let r;(r=e.fill)&&r!=="none"&&t.fillText(s.toString(),n[0],n[1],i),(r=e.stroke)&&r!=="none"&&t.strokeText(s.toString(),n[0],n[1],i)},pe=(t,e,n={attribs:{},edits:[]})=>{if(!e)return;if(V(e,"toHiccup")){pe(t,e.toHiccup(),n);return}if(mt(e[0])){for(let r of e)pe(t,r,n);return}const s=Xl(t,n,e[1]),i=s?s.attribs:n.attribs;if(!i.__skip){switch(e[0]){case"g":case"defs":r0(t,s,n,e);break;case"linearGradient":$i(n,e[1].id,Hl(t,e[1],e[2]));break;case"radialGradient":$i(n,e[1].id,Vl(t,e[1],e[2]));break;case"points":t0(t,i,e[1],e[2]);break;case"packedPoints":Ql(t,i,e[1],e[2]);break;case"line":Wn(t,i,e[2],e[3]);break;case"lines":Kl(t,i,e[2]);break;case"hline":Wn(t,i,[-1e6,e[2]],[1e6,e[2]]);break;case"vline":Wn(t,i,[e[2],-1e6],[e[2],1e6]);break;case"polyline":n0(t,i,e[2]);break;case"polygon":e0(t,i,e[2]);break;case"path":Kr(t,i,e[2]);break;case"rect":s0(t,i,e[2],e[3],e[4],e[5]);break;case"circle":Ri(t,i,e[2],e[3]);break;case"ellipse":ql(t,i,e[2],e[3],e[4],e[5],e[6]);break;case"arc":Ri(t,i,e[2],e[3],e[4],e[5]);break;case"text":i0(t,i,e[2],e[3],e[4]);break;case"img":Yl(t,i,e[1],e[2],e[3],e[4],e[5])}s&&Zl(t,n,s)}},r0=(t,e,n,s)=>{const i=s.length,r=s[0]==="g"&&e||n;for(let o=2;o<i;o++)pe(t,s[o],r)},to=t=>new o0(t);class o0{constructor(e){this.base=e,this.N=e.length,this.index=[...e].reduce((n,s,i)=>(n[s]=i,n),{})}encode(e){const{base:n,N:s}=this;if(e===0)return n[0];let i="";for(;e>0;)i=n[e%s]+i,e=Math.floor(e/s);return i}encodeBigInt(e){if(e<BigInt(2**53))return this.encode(Number(e));const{base:n,N:s}=this;if(e===BigInt(0))return n[0];const i=BigInt(s);let r="";for(;e>0;)r=n[Number(e%i)]+r,e/=i;return r}encodeBytes(e){let n="";for(let s=0,i=e.length;s<i;s++)n+=fn(e[s]);return this.encodeBigInt(BigInt(`0x${n}`))}decode(e){const{index:n,N:s}=this;let i=0;for(let r=e.length-1,o=0;o<=r;o++)i+=n[e[o]]*s**(r-o);return i}decodeBigInt(e){const{index:n,N:s}=this,i=BigInt(s);let r=BigInt(0);for(let o=e.length-1,a=0;a<=o;a++)r+=BigInt(n[e[a]])*i**BigInt(o-a);return r}decodeBytes(e,n){let s=this.decodeBigInt(e);const i=BigInt(255),r=BigInt(8);for(let o=n.length;o-- >0;)n[o]=Number(s&i),s>>=r;return n}validate(e){return new RegExp(`^[${this.base}]+$`).test(e)}size(e){return Math.ceil(Math.log(e)/Math.log(this.N))}}const eo="123456789",no="ABCDEFGHJKLMNPQRSTUVWXYZ",so="abcdefghijkmnopqrstuvwxyz",a0=eo+no+so,io=eo+so+no,c0=a0;to(c0);to(io);const Qs=[3737844653,799659867,3827263459,1552149530];[...Qs];const l0=(t,e=z,n=0,s=t.length)=>t[e.minmax(n,s)|0];class ti extends xr{constructor(e=Qs){super(),this.buffer=new Uint32Array(4),this.seed(e)}copy(){return new ti(this.buffer)}bytes(){return new Uint8Array(this.buffer.buffer)}int(){const e=this.buffer,n=(e[0]+e[1]>>>0)+e[3]>>>0;return e[3]=e[3]+1>>>0,e[0]=e[1]^e[1]>>>9,e[1]=e[2]+(e[2]<<3)>>>0,e[2]=(e[2]<<21|e[2]>>>11)+n>>>0,n}seed(e){return this.buffer.set(e),this}}const ro=(t,e,n=z)=>{const s=t.length;E(s>0,"no choices given");const i=e?t.map((o,a)=>[e[a]||0,o]).sort((o,a)=>a[0]-o[0]):t.map(o=>[1,o]),r=i.reduce((o,a)=>o+a[0],0);return r<=0&&console.warn("total weights <= 0"),()=>{const o=n.float(r);let a=r;for(let c=0;c<s;c++)if(a-=i[c][0],a<=o)return i[c][1]}},oo=t=>t.slice(2).match(new RegExp(`.{${t.length-2>>2}}`,"g")).map(e=>[...e].reduce((n,s)=>n*58+io.indexOf(s)>>>0,0));let Be;typeof fxhash=="string"?Be=oo(fxhash):(Be=Qs,console.warn("fxhash PRNG not found, using default seed",Be,`

`));const y=new ti(Be),f0=(t,e=y)=>e.float()<t,$=(t,e=y)=>l0(t,e),ws=(t,e,n=y)=>ro(t,e,n)(),u0=()=>typeof window<"u"&&!!window.chrome,h0=new Set(["__proto__","prototype","constructor"]),Xn=t=>h0.has(t),d0=t=>mt(t)?t.some(Xn):I(t)?t.indexOf(".")!==-1?t.split(".").some(Xn):Xn(t):!1,ao=t=>mt(t)?t:I(t)?t.length>0?t.split("."):[]:t!=null?[t]:[],g0=(t,e)=>{if(t==null)return!1;e=ao(e);for(let n=e.length-1,s=0;s<=n;s++){const i=e[s];if(!t.hasOwnProperty(i)||(t=t[i],t==null&&s<n))return!1}return!0},m0=t=>(E(!d0(t),`unsafe path: '${t}'`),t);function p0(t){const e=ao(t);m0(e);let[n,s,i,r]=e;switch(e.length){case 0:return(o,a)=>a;case 1:return(o,a)=>o?(o[n]=a,o):void 0;case 2:return(o,a)=>{let c;return o&&(c=o[n])?(c[s]=a,o):void 0};case 3:return(o,a)=>{let c;return o&&(c=o[n])&&(c=c[s])?(c[i]=a,o):void 0};case 4:return(o,a)=>{let c;return o&&(c=o[n])&&(c=c[s])&&(c=c[i])?(c[r]=a,o):void 0};default:return(o,a)=>{let c=o;const l=e.length-1;for(let f=0;f<l;f++)if(!(c=c[e[f]]))return;return c[e[l]]=a,o}}}const co=(t,e,n)=>p0(e)(t,n),b0=/^(function\s+\w+)?\s*\(\{([\w\s,:]+)\}/;function As(t,e){const n={prefix:"@",unwrap:!0,...e};return Rn(t)?lo(t,n):mt(t)?fo(t,n):t}const lo=(t,e,n,s=[],i={},r=[])=>{n=n||t;for(let o in t)be(n,[...s,o],i,r,e);return!e.unwrap||s.length?t:ho(t,i)},fo=(t,e,n,s=[],i={},r=[])=>{n=n||t;for(let o=0,a=t.length;o<a;o++)be(n,[...s,o],i,r,e);return!e.unwrap||s.length?t:ho(t,i)},be=(t,e,n,s,i)=>{const r=e.join("/");s.indexOf(r)>=0&&ht(`cyclic references not allowed: ${r}`);let[o,a]=uo(t,e);if(!n[r]){if(a)return n[r]=!0,o;let c=Kt;s.push(r),Rn(o)?lo(o,{...i,unwrap:!1},t,e,n,s):mt(o)?fo(o,{...i,unwrap:!1},t,e,n,s):!i.onlyFnRefs&&I(o)&&o.startsWith(i.prefix)?c=be(t,ki(e,o,i.prefix.length),n,s,i):Zi(o)?c=w0(o,l=>be(t,ki(e,l,0),n,s,i),r,n):g0(t,e)||(o=y0(t,e,n,s,i)),c!==Kt&&(co(t,e,c),o=c),n[r]=!0,s.pop()}return o},y0=(t,e,n,s,i)=>{let r=s.pop(),o;for(let a=1,c=e.length;a<=c;a++)o=be(t,e.slice(0,a),n,s,i);return s.push(r),o},w0=(t,e,n,s)=>{const i=b0.exec(t.toString());let r;if(i){const o=i[2].replace(/\s|(,\s*$)/g,"").split(/,/g).map(a=>a.split(":")[0]).reduce((a,c)=>(a[c]=e(c),a),{});r=t(o,e)}else r=t(e);return ei(r,n,s),r},ei=(t,e,n)=>{n[e]=!0,Rn(t)?A0(t,e,n):mt(t)&&S0(t,e,n)},A0=(t,e,n)=>{let s,i;for(let r in t)s=t[r],i=e+"/"+r,ei(s,i,n)},S0=(t,e,n)=>{let s,i;for(let r=0,o=t.length;r<o;r++)s=t[r],i=e+"/"+r,ei(s,i,n)},ki=(t,e,n=1)=>{if(e.charAt(n)==="/")return e.substring(n+1).split("/");t=t.slice(0,t.length-1);const s=e.substring(n).split("/");for(let i=0,r=s.length;i<r;i++)if(s[i]==="..")!t.length&&ht(`invalid lookup path: ${e}`),t.pop();else return t.concat(s.slice(i));return!t.length&&ht(`invalid lookup path: ${e}`),t};class Ci{constructor(e){this._value=e}deref(){return this._value}}const uo=(t,e)=>{const n=e.length-1;let s=t,i=t instanceof Ci;for(let r=0;s!=null&&r<=n;r++)s=s[e[r]],s instanceof Ci&&(i=!0,s=s.deref());return[s,i]},ho=(t,e)=>{for(let n in e){const s=n.split("/"),i=uo(t,s);i[1]&&co(t,s,i[0])}return t},M0=(t,e=0,n=t.length,s=z)=>{if(E(e>=0&&n>=e&&n<=t.length,`illegal range ${e}..${n}`),n-e>1)for(let i=n;i-- >e;){const r=s.minmax(e,i+1)|0,o=t[r];t[r]=t[i],t[i]=o}return t},v0=(t,e=t.length,n=z)=>M0(t,0,e,n),R0=.5*(Math.sqrt(3)-1),Ht=(3-Math.sqrt(3))/6,Ei=t=>Math.floor(t)|0,Oi=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function F0(t=Math.random){const e=$0(t),n=new Float64Array(e).map(i=>Oi[i%12*2]),s=new Float64Array(e).map(i=>Oi[i%12*2+1]);return function(r,o){let a=0,c=0,l=0;const f=(r+o)*R0,h=Ei(r+f),u=Ei(o+f),g=(h+u)*Ht,d=h-g,m=u-g,b=r-d,w=o-m;let C,pt;b>w?(C=1,pt=0):(C=0,pt=1);const X=b-C+Ht,Bn=w-pt+Ht,Un=b-1+2*Ht,Pn=w-1+2*Ht,Gn=h&255,Ln=u&255;let zt=.5-b*b-w*w;if(zt>=0){const ct=Gn+e[Ln],Pt=n[ct],Gt=s[ct];zt*=zt,a=zt*zt*(Pt*b+Gt*w)}let Bt=.5-X*X-Bn*Bn;if(Bt>=0){const ct=Gn+C+e[Ln+pt],Pt=n[ct],Gt=s[ct];Bt*=Bt,c=Bt*Bt*(Pt*X+Gt*Bn)}let Ut=.5-Un*Un-Pn*Pn;if(Ut>=0){const ct=Gn+1+e[Ln+1],Pt=n[ct],Gt=s[ct];Ut*=Ut,l=Ut*Ut*(Pt*Un+Gt*Pn)}return 70*(a+c+l)}}function $0(t){const n=new Uint8Array(512);for(let s=0;s<512/2;s++)n[s]=s;for(let s=0;s<512/2-1;s++){const i=s+~~(t()*(256-s)),r=n[s];n[s]=n[i],n[i]=r}for(let s=256;s<512;s++)n[s]=n[s-256];return n}const go=4,Fe=1<<go,mo=8,_0=1<<mo,B=4095;let po=4,bo=.5;const Zn=t=>.5*(1-Math.cos(t*Math.PI));let x;const I0=function(t,e=0,n=0){if(x==null){x=new Array(B+1);for(let b=0;b<B+1;b++)x[b]=Math.random()}t<0&&(t=-t),e<0&&(e=-e),n<0&&(n=-n);let s=Math.floor(t),i=Math.floor(e),r=Math.floor(n),o=t-s,a=e-i,c=n-r,l,f,h=0,u=.5,g,d,m;for(let b=0;b<po;b++){let w=s+(i<<go)+(r<<mo);l=Zn(o),f=Zn(a),g=x[w&B],g+=l*(x[w+1&B]-g),d=x[w+Fe&B],d+=l*(x[w+Fe+1&B]-d),g+=f*(d-g),w+=_0,d=x[w&B],d+=l*(x[w+1&B]-d),m=x[w+Fe&B],m+=l*(x[w+Fe+1&B]-m),d+=f*(m-d),g+=Zn(c)*(d-g),h+=g*u,u*=bo,s<<=1,o*=2,i<<=1,a*=2,r<<=1,c*=2,o>=1&&(s++,o--),a>=1&&(i++,a--),c>=1&&(r++,c--)}return h},k0=function(t,e){t>0&&(po=t),e>0&&(bo=e)},C0=function(t){const e=(()=>{let r,o;return{setSeed(a){o=r=(a==null?Math.random()*4294967296:a)>>>0},getSeed(){return r},rand(){return o=(1664525*o+1013904223)%4294967296,o/4294967296}}})();e.setSeed(t),x=new Array(B+1);for(let n=0;n<B+1;n++)x[n]=e.rand()};function yo(t,e,n=0,s=0){return t==="simplex"?new xi("simplex",e,n,s):t==="perlin"?new xi("perlin",e,n,s):new wo(t,e,n,s)}function E0(t,e,n=!0){for(let s=0;s<e.length-2;s++){if(t<e[s])return e[s];if(t<e[s+1])return n&&t-e[s]<e[s+1]-t?e[s]:e[s+1]}return e[e.length-1]}function O0(t,e,n={}){return 0}function D0(t,e,n={center:[.5,.5]}){const s=n.center?n.center:[.5,.5];return Math.atan2(e-s[1],t-s[0])}function Di(t,e,n={scale:1,amplitude:1}){const s=n.amplitude?n.amplitude:1,i=n.scale?n.scale:1;return _*s*Math.cos(t*i)*Math.sin(e*i)}function x0(t,e,n={scale:1,amplitude:1}){const s=n.amplitude?n.amplitude:1,i=n.scale?n.scale:1;return _*s*(Math.cos(t*i)+Math.sin(e*i))}function N0(t,e,n={scale:1,amplitude:1}){const s=n.amplitude?n.amplitude:1,i=n.scale?n.scale:1;return _*s*(Math.sin(e*i)-Math.cos(t*i))}function T0(t,e,n={scale:1,amplitude:1}){const s=n.amplitude?n.amplitude:1,i=n.scale?n.scale:1;return _*s*(Math.sin(t*i)+Math.sin(e*i))}function z0(t,e,n={scale:1,amplitude:1}){const s=n.amplitude?n.amplitude:1,i=n.scale?n.scale:1;return _*s*Math.cos(t*i)}function B0(t,e,n={scale:1,amplitude:1}){const s=n.amplitude?n.amplitude:1,i=n.scale?n.scale:1;return _*s*Math.cos(e*i)}function U0(t,e,n={scale:1,amplitude:1}){const s=n.amplitude?n.amplitude:1,i=n.scale?n.scale:1;return Math.acos(s*Math.cos(i*t))}function P0(t,e,n={scale:1,amplitude:1}){const s=n.amplitude?n.amplitude:1,i=n.scale?n.scale:1;return Math.acos(s*Math.cos(i*e))}function G0(t,e,n={a:1,b:1,c:1}){const s=n.a?n.a:1,i=n.b?n.b:1,r=n.c?n.c:1,o=e-1-Math.sqrt(Math.abs(i*t-1-r))*Math.sign(t-1),a=s-t-1;return Math.atan2(a,o)}function L0(t,e,n={a:1,b:1,c:1,d:1}){const s=n.a?n.a:1,i=n.b?n.b:1,r=n.c?n.c:1,o=n.d?n.d:1,a=Math.sin(s*e)+r*Math.cos(s*t),c=Math.sin(i*t)+o*Math.cos(i*e);return Math.atan2(c,a)}function q0(t,e,n={a:1,b:1,c:1,d:1}){const s=n.a?n.a:1,i=n.b?n.b:1,r=n.c?n.c:1,o=n.d?n.d:1,a=Math.sin(s*e)-Math.cos(i*t),c=Math.sin(r*t)-Math.cos(o*e);return Math.atan2(c,a)}function j0(t,e,n={a:1,b:1,c:1,d:1}){const s=n.a?n.a:1,i=n.b?n.b:1,r=n.c?n.c:1,o=n.d?n.d:1,a=Math.sin(i*e)+r*Math.sin(i*t),c=Math.sin(s*t)+o*Math.sin(s*e);return Math.atan2(c,a)}function H0(t,e,n={a:1,b:1}){const s=n.a?n.a:1,i=n.b?n.b:1,r=s*t+(1-s)*2*t*t/(1+t*t),o=i*e*r,a=r-t;return Math.atan2(a,o)}class wo{constructor(e,n,s=0,i){A(this,"quantizationArray",[]);A(this,"computeFn");this.type=e,this.opts=n,this.rotation=s,this.quantization=i,this.computeFn=this.getComputeFn(e),this.update()}getComputeFn(e){switch(e){case"zero":return O0;case"radial":return D0;case"sinTimesCos":return Di;case"sinPlusCos":return x0;case"sinMinusCos":return N0;case"sinPusSin":return T0;case"cosX":return z0;case"cosY":return B0;case"aCosX":return U0;case"aCosY":return P0;case"hopalong":return G0;case"clifford":return L0;case"fractalDream":return j0;case"gumowskiMira":return H0;case"deJong":return q0}return Di}update(){if(typeof this.quantization=="number"){this.quantizationArray=[0,_];for(let n=1;n<this.quantization;n++)this.quantizationArray.splice(n,0,n*_/this.quantization)}else this.quantizationArray=this.quantization;const e=this.opts.quantizationShift?this.opts.quantizationShift:0;this.quantizationArray=this.quantizationArray.map(n=>n+e)}getRawValue(e,n){const[s,i]=e,r={...this.opts,...n};return this.computeFn(s,i,r)}getValue(e,n){return n&&n.clamp?Ar(this.getRawValue(e,n)):this.getRawValue(e,n)}getQuantizedValue(e,n){const s=this.getValue(e,n);return this.quantization===0?s+this.rotation:E0(s,this.quantizationArray,n?n.quantizeToClosest:!0)+this.rotation}}class xi extends wo{constructor(n,s,i=0,r){super(n,s,i,r);A(this,"noise2D");if(this.type=n,this.opts=s,this.rotation=i,this.quantization=r,n==="simplex")this.noise2D=F0(y.float.bind(y));else{C0(oo(fxhash)),this.noise2D=I0;const o=s.lod?s.lod:4,a=s.falloff?s.falloff:.5;k0(o,a)}}getRawValue(n,s){const[i,r]=n,o={...this.opts,...s},a=o.amplitude?o.amplitude:1,c=o.scale?o.scale:1;return _*a*this.noise2D(i*c,r*c)}}class ni{constructor(e,n,s,i,r,o,a,c,l,f,h){A(this,"line");A(this,"additionalShapes",[]);A(this,"active",!0);A(this,"generation");A(this,"fixedAttribs");A(this,"spaceTraveled",0);A(this,"lengths",[0]);A(this,"velocity",new S);A(this,"length",0);this.ID=e,this.pos=n,this.dir=s,this.BOUNDS=i,this.spaceManager=r,this.vectorField=o,this.vectorFieldTransform=a,this.useVectorFieldTransform=c,this.agentAttribs=l,this.maxLength=f,this.parent=h,this.fixedAttribs={},this.generation=h?h.generation+1:0,this.line=[new Ct([te(n)],l.getAttribs(this))]}update(e,{fuzziness:n=0,chance:s=1},i=!1,r){const{BOUNDS:o,spaceManager:a,active:c,agentAttribs:l}=this;if(c){const f=this.move(e,n,r);if(this.active=this.checkStopCondition(o,a),this.active){const h=gs(this.line);if(this.spaceTraveled+=f,f0(s)&&(this.addSegment(h,this.pos),this.lengths[this.lengths.length-1]+=f,this.length+=f,i)){const u=l.getAttribs(this);At(u,h.attribs)||(this.line.push(new Ct([te(this.pos)],u)),this.lengths.push(0))}}else this.additionalShapes=[];return this.active}return!0}addSegment(e,n){e.points.push(te(n))}move(e,n=0,s){const{pos:i,dir:r}=this;return this.velocity=Er([],je([],r,this.vectorField.getQuantizedValue(this.useVectorFieldTransform?this.vectorFieldTransform(i):i)),e),n>0&&It(null,this.velocity,[y.minmax(-n,n),y.minmax(-n,n)]),It(null,i,this.velocity),Bs(this.velocity)}getShape(e,n,s=1e4,i=!0){const r=[];let o=s;for(let a=this.line.length-1;a>=0&&o>0;a--)if(this.line[a].points.length<=o)o-=this.line[a].points.length,r.unshift(this.line[a]);else{const c=this.line[a].copy();c.points=c.points.slice(-o),r.unshift(c);break}if(n.type==="points"){const a=[],c=this.agentAttribs.getSandAttribs(this);for(const l of r){const f=(l.attribs?l.attribs.weight:1)*c.weightFactor,h=new kt(l.points,{...l.attribs,weight:f,shape:"circle"});a.push(h)}return an(this.fixedAttribs,a.map(l=>ge(l,e)))}return an(this.fixedAttribs,r.map(a=>ge(a,e)))}getStart(){return this.line?this.line[0].points[0]:this.pos}getAttribs(){return this.line[0].attribs}getFactor(e,n){let s;switch(e){case"agentID":return this.ID/n.agents.max;case"agentGeneration":return this.generation;case"pos":return[this.pos[0]/n.aspectRatio,this.pos[1]];case"heightPos":return this.pos[1];case"widthPos":return this.pos[0]/n.aspectRatio;case"heightStart":return s=this.getStart(),s[1];case"widthStart":return s=this.getStart(),s[0]/n.aspectRatio;case"start":return s=this.getStart(),[s[0]/n.aspectRatio,s[1]];case"distancePosCenter":return Math.pow(this.pos[0]-.5*n.aspectRatio,2)+Math.pow(this.pos[1]-.5,2);case"distanceStartCenter":return s=this.getStart(),Math.pow(s[0]-.5*n.aspectRatio,2)+Math.pow(s[1]-.5,2);case"random":return y.minmax(0,1)}return 0}getPos(){return this.pos}checkStopCondition(e,n){return hn(e,this.pos)&&!n.checkCollision(this,0,!0,!0)&&this.length<=this.maxLength}isRemovable(){return this.line.length===1&&this.line[0].points.length<2}}class Ao extends ni{constructor(e,n,s,i,r,o,a,c,l,f,h){super(e,n,s,i,r,o,a,c,l,f,h),this.ID=e,this.pos=n,this.dir=s,this.BOUNDS=i,this.spaceManager=r,this.vectorField=o,this.vectorFieldTransform=a,this.useVectorFieldTransform=c,this.agentAttribs=l,this.maxLength=f,this.parent=h}addSegment(e,n){this.additionalShapes=[],super.addSegment(e,n);const s=this.agentAttribs.getSandAttribs(this);e.points.length>1&&(this.drawSandedLine(e,s,e.points[e.points.length-2],this.spaceManager.freeLine(this,e.points[e.points.length-2],je([],this.velocity,ee),s.maxLength,s.followBounds?this.BOUNDS:void 0)),s.doubleSided&&this.drawSandedLine(e,s,e.points[e.points.length-2],this.spaceManager.freeLine(this,e.points[e.points.length-2],je([],this.velocity,-ee),s.maxLength,s.followBounds?this.BOUNDS:void 0)))}drawSandedLine(e,n,s,i){const r=sn([],i,s),o=Bs(r);let a=Math.floor(o*n.grainsFactor);for(let c=0;c<a;c++){const l=on(n.minAlpha,n.maxAlpha?n.maxAlpha:n.alpha,n.alphaDecay(c/a)),f=new kt([sl([],i,s,[c/a,c/a])],{stroke:n.stroke,size:Math.max(1e-4,n.weight*n.weightFactor),weight:n.weight*n.weightFactor,shape:"circle",alpha:l});this.additionalShapes.push(f)}}getShape(e,n,s=1e4,i=!0){let r=super.getShape(e,n,s,i);return r.children.push(...this.additionalShapes.map(o=>ge(o,e))),r}}class V0{constructor(e,n,s,i,r=[cn([0,0],[1,1])],o=[cn([0,0],[1,1])],a,c,l=!0){A(this,"agents",[]);A(this,"spaceTraveled",0);A(this,"iterations",0);A(this,"nextAgentID",0);A(this,"agentsToCreate",0);A(this,"toCreate",0);this.spaceManager=e,this.vectorField=n,this.agentFeatures=s,this.minMovement=i,this.BOUNDS=r,this.initBOUNDS=o,this.agentAttribs=a,this.AgentConstructor=c,this.createAllAgents=l,e.setAgents(this.agents)}createAgent(e=!1,n,s,i,r,o,a){const{pos:c,agent:l}=e?this.spaceManager.randomOccupied(n):this.spaceManager.randomFree(n);if(c){const f=l?je([],$([new S([l.dir[1],-l.dir[0]]),new S([-l.dir[1],l.dir[0]])],y),this.agentFeatures.angled?l?l.vectorField.getQuantizedValue(c):r.getQuantizedValue(c):0):$(i,y),h=new this.AgentConstructor(this.nextAgentID++,c,f,s,this.spaceManager,o&&l?l.vectorField:r,l?l.vectorFieldTransform:a,o,this.agentAttribs,y.minmax(this.agentFeatures.maxLineLength[0],this.agentFeatures.maxLineLength[1]),l);return this.spaceTraveled+=h.move(this.minMovement,0),this.agents.push(h),!0}return!1}cleanUpAgents(e=!0){const n=e?this.getInactiveAgents():this.agents;for(const s of n)s.isRemovable()&&this.agents.splice(0,this.agents.length,...this.agents.filter(i=>i!==s))}updateAgents(e,n,s,{fuzziness:i=0,chance:r=1},o=!1){if(this.iterations=this.iterations+1,this.iterations<this.agentFeatures.maxIterations&&this.spaceTraveled<this.agentFeatures.maxSpaceTraveled){const a=this.getActiveAgents().map(f=>f.update(e,{fuzziness:i,chance:r},o)).filter(f=>f===!1);this.cleanUpAgents();const c=this.getActiveAgents().length;return this.spaceTraveled=this.agents.reduce((f,h)=>f+h.spaceTraveled,0),this.agentsToCreate+=a.length*n,this.toCreate=Math.min(this.createAllAgents?this.agentsToCreate:a.length*n,s,this.agentFeatures.max-this.agents.length,this.agentFeatures.maxActive-c),c+this.toCreate>0}return this.cleanUpAgents(!1),!1}getActiveAgents(){return this.agents.filter(e=>e.active)}getInactiveAgents(){return this.agents.filter(e=>!e.active)}getAgents(e=!0){return e?this.getActiveAgents():this.agents}log(){return{iterations:this.iterations,agents:this.agents.length,activeAgents:this.getActiveAgents().length,agentsToCreate:this.agentsToCreate,toCreateNow:this.toCreate}}}var Ni;(function(t){t[t.RED=0]="RED",t[t.ORANGE=1]="ORANGE",t[t.YELLOW=2]="YELLOW",t[t.CHARTREUSE=3]="CHARTREUSE",t[t.GREEN=4]="GREEN",t[t.SPRING_GREEN=5]="SPRING_GREEN",t[t.CYAN=6]="CYAN",t[t.AZURE=7]="AZURE",t[t.BLUE=8]="BLUE",t[t.VIOLET=9]="VIOLET",t[t.MAGENTA=10]="MAGENTA",t[t.ROSE=11]="ROSE"})(Ni||(Ni={}));class Vt{constructor(e,n){this.mode=e,this.value=n}deref(){return this.value}}const Y0={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",grey:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32",transparent:"0000",rebeccapurple:"639"};let W0={canvas:"fff",canvastext:"000",linktext:"001ee4",visitedtext:"4e2386",activetext:"eb3323",buttonface:"ddd",buttontext:"000",buttonborder:"000",field:"fff",fieldtext:"000",highlight:"bbd5fb",highlighttext:"000",mark:"000",marktext:"fff",graytext:"808080"};const X0=xt((t,e=3,n=",",s="[",i="]")=>{const r=typeof e=="number"?Ls(e):e;switch(t){case 1:return o=>`${s}${r(o[0])}${i}`;case 2:return o=>`${s}${r(o[0])}${n}${r(o[1])}${i}`;case 3:return o=>`${s}${r(o[0])}${n}${r(o[1])}${n}${r(o[2])}${i}`;case 4:return o=>`${s}${r(o[0])}${n}${r(o[1])}${n}${r(o[2])}${n}${r(o[3])}${i}`;default:return o=>{const a=[];for(let c=0;c<o.length;c++)a.push(r(o[c]));return`${s}${a.join(n)}${i}`}}}),Z0=t=>(t&3840)*4352|(t&240)*272|(t&15)*17,J0=t=>((t&61440)*69632|(t&3840)*4352|(t&240)*272|(t&15)*17)>>>0,ye=(t,e)=>v(t||[],(e>>>16&255)*Q,(e>>>8&255)*Q,(e&255)*Q,(e>>>24)*Q),So=(t,e)=>v(t||[],(e&255)*Q,(e>>>8&255)*Q,(e>>>16&255)*Q,(e>>>24)*Q),si=t=>{t=(I(t)?t:t.deref()).toLowerCase();const e=Y0[t]||W0[t];if(e||t[0]==="#")return new Vt("srgb",ye([],Q0(e||t)));const n=t.split(/[(),/ ]+/),[s,i,r,o,a]=n;switch(E(n.length===5||n.length===6,`invalid ${s} color: ${t}`),s){case"rgb":case"rgba":return new Vt("srgb",[Ue(i),Ue(r),Ue(o),$e(a)]);case"hsl":case"hsla":return new Vt("hsl",[Ti(i),_e(r),_e(o),$e(a)]);case"lab":return new Vt("lab50",[_e(i,!1),Jn(r)*.01,Jn(o)*.01,$e(a)]);case"lch":return new Vt("lch",[_e(i,!1),Jn(r)*.01,Ti(o),$e(a)]);default:Me(`color mode: ${s}`)}},K0={rad:_,grad:400,turn:1,deg:360,undefined:360},Ti=t=>{const e=/^(-?[0-9.]+)(deg|rad|grad|turn)?$/.exec(t);return E(!!e,`expected hue, got: ${t}`),M(parseFloat(e[1])/K0[e[2]])},$e=t=>t?Ue(t,1):1,_e=(t,e=!0)=>{E(/^([0-9.]+)%$/.test(t),`expected percentage, got: ${t}`);const n=parseFloat(t)/100;return e?p(n):n},Jn=t=>(E(/^-?[0-9.]+$/.test(t),`expected number, got: ${t}`),parseFloat(t)),Ue=(t,e=255,n=!0)=>{E(/^-?[0-9.]+%?$/.test(t),`expected number or percentage, got: ${t}`);const s=parseFloat(t)/(t.endsWith("%")?100:e);return n?p(s):s},Q0=t=>{const e=/^#?([0-9a-f]{3,8})$/i.exec(t);if(e){const n=e[1];switch(n.length){case 3:return(Z0(parseInt(n,16))|4278190080)>>>0;case 4:return J0(parseInt(n,16))>>>0;case 6:return(parseInt(n,16)|4278190080)>>>0;case 8:return parseInt(n,16)>>>0}}return ht(`invalid hex color: "${t}"`)},En=(t,e)=>v(t||e,Yn(e[0]),Yn(e[1]),Yn(e[2]),F(e[3])),Mo=(t,e)=>En(null,ye(t,e)),tf=(t,e)=>En(null,So(t,e)),On=t=>{const e=t.channels||{},n=t.order,s=n.length;n.reduce((u,g)=>(u[g]={range:[0,1],...e[g]},u),e);const i=n.map(u=>e[u].range[0]),r=n.map(u=>e[u].range[1]),o=Qt([],i),a=Qt([],r);o[s-1]=1;const c=n.findIndex(u=>!!e[u].hue),l=class{constructor(u,g=0,d=1){this.offset=g,this.stride=d,this.buf=u||[0,0,0,0],this.offset=g,this.stride=d}get mode(){return t.mode}get length(){return s}get range(){return[i,r]}get[Symbol.toStringTag](){return t.mode}[Symbol.iterator](){return _r(this.buf,this.length,this.offset,this.stride)}copy(){return new l(this.deref())}copyView(){return new l(this.buf,this.offset,this.stride)}empty(){return new l}deref(){return[this[0],this[1],this[2],this[3]]}set(u){return Qt(this,u)}clamp(){return c>=0&&(this[c]=M(this[c])),Zc(null,this,i,r),this}eqDelta(u,g=T){return $r(this,u,g)}randomize(u){return Nr(this,o,a,u)}toJSON(){return this.deref()}toString(){return X0(4,4)(this)}};Ir(l.prototype,n),yi(t.mode,t.from),yi("rgb",{[t.mode]:t.toRgb});const f=(u,g,d)=>{const m=new l(...d);return g!==t.mode?Pr(m,u,t.mode,g):m.set(u)},h=(u,...g)=>u==null?new l:I(u)?h(si(u),...g):An(u)?I(u.mode)?f(u,u.mode,g):new l(u,...g):V(u,"deref")?f(u.deref(),u.mode,g):O(u)?g.length&&g.every(O)?new l(...bl([u,...g])):f(Mo([],u),"rgb",g):ht(`can't create a ${t.mode} color from: ${u}`);return h.class=l,h.range=[i,r],h.random=(u,g,d,m)=>new l(g,d,m).randomize(u),h.mapBuffer=(u,g=u.length/s|0,d=0,m=1,b=s)=>qs(l,u,g,d,m,b),h},Ss=(t,e=Gr)=>Fr(t,e),ef=t=>Fr(t,ul),nf=t=>((t>>>16&255)*76+(t>>>8&255)*150+(t&255)*29)/65025,sf=t=>((t>>>16&255)*29+(t>>>8&255)*150+(t&255)*76)/65025,rf=t=>nf(t[0]),of=t=>sf(t[0]),ii=(t,e,n=1)=>(e=M(e)*6,v(t||[],p(Math.abs(e-3)-1),p(2-Math.abs(e-2)),p(2-Math.abs(e-4)),n)),vo=(t,e)=>{const n=e[0];let s=e[1];const i=e[2],r=ii(t||e,n,F(e[3])),o=Ss(r);return i<o?s*=i/o:o<1&&(s*=(1-i)/(1-o)),U(r,p((r[0]-o)*s+i),p((r[1]-o)*s+i),p((r[2]-o)*s+i))},Ro=(t,e)=>{t=Ys(t||e,e);const n=t[1],s=t[2];if(n<1e-6)return U(t,s,s,s);const i=t[0]*6%6,r=s*(1-n),o=1-Math.abs(i%2-1);let a=3*s*n/(1+o);const c=a*o+r;switch(a+=r,i|0){case 0:return U(t,a,c,r);case 1:return U(t,c,a,r);case 2:return U(t,r,a,c);case 3:return U(t,r,c,a);case 4:return U(t,c,r,a);case 5:return U(t,a,r,c);default:return U(t,r,r,r)}},Fo=(t,e)=>{const n=p(e[1]),s=p(e[2]);t=ii(t||e,e[0],F(e[3]));const i=(1-Math.abs(2*s-1))*n;return U(t,(t[0]-.5)*i+s,(t[1]-.5)*i+s,(t[2]-.5)*i+s)},$o=(t,e)=>{t=Ys(t||e,e);const n=t[1],s=t[2];return ii(t,e[0],t[3]),U(t,((t[0]-1)*n+1)*s,((t[1]-1)*n+1)*s,((t[2]-1)*n+1)*s)},dn=On({mode:"srgb",order:["r","g","b","alpha"],from:{abgr32:(t,e)=>So(t,e[0]),argb32:(t,e)=>ye(t,e[0]),hcy:vo,hsi:Ro,hsl:Fo,hsv:$o,rgb:re},toRgb:En}),_o=t=>(F(t[3])*255+.5<<24|p(t[0])*255+.5<<16|p(t[1])*255+.5<<8|p(t[2])*255+.5)>>>0,af=t=>(F(t[3])*255+.5<<24|p(t[2])*255+.5<<16|p(t[1])*255+.5<<8|p(t[0])*255+.5)>>>0;class Io{constructor(e,n=0,s=1){this.offset=n,this.stride=s,this.buf=e||[0]}eqDelta(e,n){return $r(ye([],this[0]),ye([],e[0]),n)}get length(){return 1}get range(){return[[0],[4294967295]]}get alpha(){return(this[0]>>>24)/255}set alpha(e){this[0]=this[0]&16777215|H(e,24)}*[Symbol.iterator](){yield this[0]}deref(){return[this[0]]}randomize(e=z){const n=this[0];return this[0]=n&4278190080|e.int()&16777215,this}clamp(){return this}set(e){return this[0]=e[0],this}toJSON(){return[this[0]]}}class Rt extends Io{get mode(){return"argb32"}get r(){return(this[0]>>16&255)/255}set r(e){this[0]=this[0]&4278255615|H(e,16)}get g(){return(this[0]>>8&255)/255}set g(e){this[0]=this[0]&4294902015|H(e,8)}get b(){return(this[0]&255)/255}set b(e){this[0]=this[0]&4294967040|H(e)}copy(){return new Rt([this[0]])}copyView(){return new Rt(this.buf,this.offset,this.stride)}empty(){return new Rt}}Gs(Rt.prototype,"value",0);class Ft extends Io{get mode(){return"abgr32"}get r(){return(this[0]&255)/255}set r(e){this[0]=this[0]&4294967040|H(e)}get g(){return(this[0]>>8&255)/255}set g(e){this[0]=this[0]&4294902015|H(e,8)}get b(){return(this[0]>>16&255)/255}set b(e){this[0]=this[0]&4278255615|H(e,16)}copy(){return new Ft([this[0]])}copyView(){return new Ft(this.buf,this.offset,this.stride)}empty(){return new Ft}}Gs(Ft.prototype,"value",0);const ko=(t,e)=>{const n=(s,...i)=>s==null?new t:O(s)?i.length&&i.every(O)?new t([_o([s,...i])]):new t([s],...i):I(s)?n(si(s)):An(s)?I(s.mode)?new t([e(dn(s))],...i):new t(s,...i):V(s,"deref")?new t([e(dn(s))],...i):ht(`can't create a ARGB32 color from: ${s}`);return n.class=t,n.range=[[0],[4294967295]],n.random=(s=z,i,r,o)=>new t(i,r,o).set([s.int()&16777215|4278190080]),n.mapBuffer=(s,i=s.length,r=0,o=1,a=1)=>qs(t,s,i,r,o,a),n},cf=ko(Rt,_o);ko(Ft,af);const lf=(t,e,n=hl)=>kn(null,n,ms(t,e)),Kn=t=>t>.00885645?Math.cbrt(t):7.787037*t+16/116,Dt=(t,e,n=Lr)=>{const s=Kn(e[0]/n[0]),i=Kn(e[1]/n[1]),r=Kn(e[2]/n[2]);return v(t||e,1.16*i-.16,5*(s-i),2*(i-r),F(e[3]))},Co=(t,e)=>Dt(null,lf(t,e)),ri=(t,e)=>kn(t,ml,e),Eo=(t,e)=>Dt(t,ri(t,Vr(t,e))),ff=On({mode:"lab50",channels:{a:{range:[-.7929,.9355]},b:{range:[-1.1203,.9339]}},order:["l","a","b","alpha"],from:{rgb:Co,lch:In,lab65:Eo,xyz50:Dt,xyz65:[ri,Dt]},toRgb:Ot}),we=On({mode:"lch",channels:{c:{range:[0,1.312]},h:{hue:!0}},order:["l","c","h","alpha"],from:{rgb:(t,e)=>jt(null,Co(t,e)),lab50:jt,lab65:[Eo,jt],xyz50:[Dt,jt],xyz65:[ri,Dt,jt]},toRgb:[In,Ot]}),uf=[4.0767245293,-1.2681437731,-.0041119885,-3.3072168827,2.6093323231,-.7034763098,.2307590544,-.341134429,1.7068625689],hf=(t,{0:e,1:n,2:s,3:i})=>kn(t,uf,[(e+.3963377774*n+.2158037573*s)**3,(e-.1055613458*n-.0638541728*s)**3,(e-.0894841775*n-1.291485548*s)**3,i]),df=(t,e)=>{const{0:n,1:s,2:i}=e;return v(t||e,bi(i*n,s),i,bi(i*(1-n-s),s),F(e[3]))},gf=(t,e,n=Gr)=>{const s=e[0],i=(2-2*n[2])*e[1],r=(2-2*n[0])*e[2];return v(t||e,s+r,s-n[2]/n[1]*i-n[0]/n[1]*r,s+i,F(e[3]))},P=On({mode:"rgb",order:["r","g","b","alpha"],from:{abgr32:(t,e)=>tf(t,e[0]),argb32:(t,e)=>Mo(t,e[0]),hcy:vo,hsi:Ro,hsl:Fo,hsv:$o,lab50:Ot,lab65:Yr,lch:[In,Ot],oklab:hf,rgb:Qt,srgb:En,xyy:[df,bs],xyz50:Xs,xyz65:bs,ycc:gf},toRgb:Qt}),Dn=t=>t.mode,Oo=(t,e)=>e.mode,zi=(t,e,n)=>e!==0?t+n.norm(e):t,et=(t,e,n,s=p)=>e!==0?s(t+n.norm(e)):t,Do=(t,e,n)=>et(t,e,n,M),xn=(t,e,n)=>(s,i,r,o=z)=>v(s||i,t(i[0],r,o),e(i[1],r,o),n(i[2],r,o),F(i[3])),Ie=xn(Do,et,et),mf=xn(et,et,et),Qn=xn(et,zi,zi),pf=at(Oo,{},{hcy:Ie,hsi:Ie,hsl:Ie,hsv:Ie,lab50:Qn,lab65:Qn,lch:xn(et,et,Do),ycc:Qn,[N]:mf}),bf=(t=z)=>t.float()<.5,yf=(t,e=W)=>t[2]<=e,Bi=(t,e=W)=>t[0]<=e&&t[1]<=e&&t[2]<=e,wf=(t,e=W)=>t[0]<=e,Af=at(Dn,{hcy:"hsv",hsi:"hsv",hsl:"hsv",labD50:"lch",labD65:"lch",srgb:"rgb",ycc:"rgb"},{hsv:yf,lch:wf,rgb:Bi,[N]:t=>Bi(P(t))}),Sf=(t,e=W)=>t[1]<=e,Ui=(t,e=W)=>Et(t[0],t[1],e)&&Et(t[0],t[2],e),Mf=(t,e=W)=>Et(t[1],0,e)&&Et(t[2],0,e),vf=at(Dn,{hcy:"hsv",hsi:"hsv",hsl:"hsv",lch:"hsv",labD65:"labD50",srgb:"rgb",ycc:"labD50"},{hsv:Sf,labD50:Mf,rgb:Ui,[N]:t=>Ui(P(t))}),Rf=(t,e=W)=>t[1]<=e&&t[2]>=1-e,Pi=(t,e=W)=>(e=1-e,t[0]>=e&&t[1]>=e&&t[2]>=e),Ff=(t,e=W)=>t[1]<=e&&t[0]>=1-e,$f=at(Dn,{hsl:"hsv",hsi:"hsv",labD50:"lch",labD65:"lch",srgb:"rgb",ycc:"lch"},{hcy:(t,e=W)=>t[1]<=e&&t[2]>=1-e,hsv:Rf,lch:Ff,rgb:Pi,[N]:t=>Pi(P(t))}),Nn={light:{c:[[.3,.7]],l:[[.9,1]],b:[[.35,.5]],w:[[.6,1]]},dark:{c:[[.7,1]],l:[[.15,.4]],b:[[0,.4]],w:[[.4,.6]]},bright:{c:[[.75,.95]],l:[[.8,1]]},weak:{c:[[.15,.3]],l:[[.7,1]],b:[[.4,.6]],w:[[.8,1]]},neutral:{c:[[.25,.35]],l:[[.3,.7]],b:[[.25,.4]],w:[[.9,1]]},fresh:{c:[[.4,.8]],l:[[.8,1]],b:[[.05,.3]],w:[[.8,1]]},soft:{c:[[.2,.3]],l:[[.6,.9]],b:[[.05,.15]],w:[[.6,.9]]},hard:{c:[[.85,.95]],l:[[.4,1]]},warm:{c:[[.6,.9]],l:[[.4,.9]],b:[[.2,.3]],w:[[.8,1]]},cool:{c:[[.05,.2]],l:[[.9,1]],b:[[0,.95]],w:[[.95,1]]},intense:{c:[[.9,1]],l:[[.2,.35],[.8,1]]}},Yt=[[0,1]],_f={h:Yt,c:Yt,l:Yt,b:Yt,w:Yt,a:[[1,1]]},xo={num:1/0,variance:.025,eps:.001,rnd:z},bt=(t,e)=>e.minmax(...t[e.int()%t.length]),If=(t,e)=>{t={..._f,...I(t)?Nn[t]:t};const{base:n,variance:s,rnd:i,eps:r}={...xo,...e};let o,a,c,l;if(n){const f=we(n);o=f[2],l=F(f[3]),Af(f,r)?(a=0,c=bt(t.b,i)):$f(f,r)?(a=0,c=bt(t.w,i)):vf(f,r)?(a=0,c=bt(bf(i)?t.b:t.w,i)):o=M(o+i.norm(s))}else o=bt(t.h,i),l=bt(t.a,i);return we([c!=null?c:bt(t.l,i),a!==void 0?a:bt(t.c,i),o,l])},kf=(t,e)=>{let n;return mt(t)?n=Cf(t):I(t)?n=Ef(t):(n={...t},n.weight==null&&(n.weight=1)),I(n.range)&&(n.range=Nn[n.range]),I(n.base)&&(n.base=we(si(n.base))),n.base!==void 0&&(e={...e,base:n.base}),{spec:n,opts:e}},Cf=t=>{let e;const[n,...s]=t;return O(gs(s))?(e=gs(s),s.pop()):e=1,s.length===1?{range:n,base:s[0],weight:e}:s.length===0?Nn[n]?{range:n,weight:e}:{base:n,weight:e}:ht(`invalid theme part: "${t}"`)},Ef=t=>Nn[t]?{range:t,weight:1}:{base:t,weight:1};function*Of(t,e={}){let{num:n,variance:s,rnd:i}={...xo,...e};const r=t.map(a=>kf(a,e)),o=ro(r,r.map(a=>a.spec.weight),i);for(;--n>=0;){const{spec:a,opts:c}=o();a.range?yield If(a.range,c):a.base&&(yield pf(we(),we(a.base),s,i))}}function Df(t,...e){let[n,s,i,r,o,a,c,l]=e;switch(e.length){case 1:return(...f)=>t(n,...f);case 2:return(...f)=>t(n,s,...f);case 3:return(...f)=>t(n,s,i,...f);case 4:return(...f)=>t(n,s,i,r,...f);case 5:return(...f)=>t(n,s,i,r,o,...f);case 6:return(...f)=>t(n,s,i,r,o,a,...f);case 7:return(...f)=>t(n,s,i,r,o,a,c,...f);case 8:return(...f)=>t(n,s,i,r,o,a,c,l,...f);default:ht()}}const xf=()=>t=>t;function*Nf(t){const{min:e,max:n,num:s,init:i,mix:r,stops:o}=t,a=t.easing||(m=>m);let c=o.length;if(c<1)return;c===1&&(yield*Ll(r(i(o[0][1],o[0][1]),0),s)),o.sort((m,b)=>m[0]-b[0]),o[c-1][0]<n&&o.push([n,o[c-1][1]]),o[0][0]>e&&o.unshift([e,o[0][1]]);const l=n-e;let f=o[0][0],h=o[1][0],u=h-f,g=i(o[0][1],o[1][1]),d=1;c=o.length;for(let m of Ur(s)){if(m=e+l*m,m>h){for(;d<c&&m>o[d][0];)d++;f=o[d-1][0],h=o[d][0],u=h-f,g=i(o[d-1][1],o[d][1])}yield r(g,a(u!==0?(m-f)/u:0))}}const Tf=(t,e)=>Mn(Y(([n,s,i,r])=>p(n+s*Math.cos(_*(i*e+r)))),ks(),qe(...t)),Gi=(t,e,n)=>Mn(Is(Y(Df(Tf,e)),n?Y(n):xf()),ks(),Ur(t-1)),Li=(t,e)=>{t=ms([],t),e=ms([],e);const n=[...Y(([s,i])=>.5*(s-i),qe(t,e))];return[[...Y(([s,i])=>s-i,qe(t,n))],n,[-.5,-.5,-.5,-.5],[0,0,0,0]]},No=(t,e,n,s)=>(i,r,o,a)=>v(i||r,t(r[0],o[0],a),e(r[1],o[1],a),n(r[2],o[2],a),s(r[3],o[3],a)),To=(t,e,n)=>{t=M(t),e=M(e);const s=e-t;return M(t+(Math.abs(s)>.5?s<0?s+1:-(1-s):s)*n)},$t=on,ke=No(To,$t,$t,$t),zf=No($t,$t,To,$t),Bf=at(Oo,{},{hcy:ke,hsi:ke,hsl:ke,hsv:ke,lch:zf,[N]:Xc});function Uf(t,e){const n=[...Pf(t)];if(e===void 0)return n;const s=n.map(i=>cf(i)[0]);return e?s.map(Ml):s}const Pf=({num:t,stops:e,easing:n,mix:s})=>Nf({num:t-1,stops:e,easing:n,min:0,max:1,init:(i,r)=>[i,r],mix:s?([i,r],o)=>s(i.empty(),i,r,o):([i,r],o)=>Bf(i.empty(),i,r,o)}),qi=at(Dn,{lch:"lab",oklab:"lab",ycc:"lab",xyy:"hcy"},{argb32:rf,abgr32:of,hcy:t=>t[2],lab:t=>t[0],rgb:Ss,srgb:ef,xyz:t=>t[1],[N]:t=>Ss(P(t))}),Wt=.072,Xt=.213,Gf=.285,Zt=.715,Lf=.787,qf=.928,ji=Rl,Hi=t=>[Xt+Lf*t,Zt-Zt*t,Wt-Wt*t,0,0,Xt-Xt*t,Zt+Gf*t,Wt-Wt*t,0,0,Xt-Xt*t,Zt-Zt*t,Wt+qf*t,0,0,0,0,0,1,0];class jf{constructor(e,n,s){A(this,"gradient");this.preset=e,this.style=n,this.images=s,this.gradient=e.colors.fg.length>1?Uf({num:50,stops:e.colors.fg.map((i,r)=>[r/(e.colors.fg.length-1),ff(i)])}).map(i=>P(i)):e.colors.fg.map(i=>P(i))}factorIsPersistent(e){switch(e){case"agentID":return!0;case"agentGeneration":return!0;case"pos":return!1;case"start":return!0;case"distanceStartCenter":return!0;case"distancePosCenter":return!1;case"random":return!0;case"heightPos":return!1;case"widthPos":return!1;case"heightStart":return!0;case"widthStart":return!0}return!1}getWeight(e){const{factor:n,values:s,fn:i}=this.preset.weight,r=e.getFactor(n,this.preset),o=i(s[0],s[1],r);return this.factorIsPersistent(n)&&(e.fixedAttribs.weight=o),o}getColor(e){const{factor:n,values:s,fn:i,using:r}=this.preset.stroke;let o=P("#000000");const a=e.getFactor(n,this.preset);if(r==="colors"){const{fg:l}=this.preset.colors,f=l.length;o=P(l[Math.floor(i(s[0]*f,s[1]*f,a))])}else if(r==="colors range")Math.floor(i(s[0]*this.gradient.length,s[1]*this.gradient.length,a)),o=this.gradient[Math.min(Math.floor(i(s[0]*this.gradient.length,s[1]*this.gradient.length,a)),this.gradient.length-1)];else if(this.images.length>0&&(r==="image0/color"||r==="image0/luminance")){const l=this.images[0].getAt(Math.floor(a[0]*this.images[0].width),Math.floor(a[1]*this.images[0].height));if(o=P(l),r==="image0/luminance"){const{fg:f}=this.preset.colors,h=f.length;o=P(f[Math.floor(i(0+s[0]*h,s[1]*h,qi(o)))])}}const c=me(o);return this.factorIsPersistent(n)&&(e.fixedAttribs.stroke=c),c}getAlpha(e){const{factor:n,values:s,fn:i,using:r}=this.preset.alpha;let o=e.getFactor(n,this.preset);if(r==="image0/luminance"&&this.images.length>0){const c=this.images[0].getAt(Math.floor(o[0]*this.images[0].width),Math.floor(o[1]*this.images[0].height));o=qi(P(c))}const a=i(s[0],s[1],o);return this.factorIsPersistent(n)&&(e.fixedAttribs.alpha=a),a}getAttribs(e){return{stroke:e.fixedAttribs.stroke?e.fixedAttribs.stroke:this.getColor(e),weight:e.fixedAttribs.weight?e.fixedAttribs.weight:this.getWeight(e),alpha:e.fixedAttribs.alpha?e.fixedAttribs.alpha:this.getAlpha(e)}}getSandAttribs(e){return{alphaDecay:this.style.alphaDecay?this.style.alphaDecay:n=>n,maxLength:this.style.maxLength?this.style.maxLength:.1,grainsFactor:this.style.grainsFactor?this.style.grainsFactor:1,minAlpha:this.style.minAlpha?this.style.minAlpha:0,maxAlpha:this.style.maxAlpha,followBounds:this.style.followBounds?this.style.followBounds:!1,weightFactor:this.style.weightFactor?this.style.weightFactor:1,doubleSided:this.style.doubleSided,...this.getAttribs(e)}}}const Tn=(t,e={})=>{const n=Reflect.ownKeys(t),s=Reflect.ownKeys(e),i=Symbol("isa");function r(o){for(let a of n){const c=Object.getOwnPropertyDescriptor(o.prototype,a);(!c||c.configurable)&&Object.defineProperty(o.prototype,a,{value:t[a],writable:!0})}return Object.defineProperty(o.prototype,i,{value:!0}),o}for(let o of s)Object.defineProperty(r,o,{value:e[o],enumerable:e.propertyIsEnumerable(o)});return Object.defineProperty(r,Symbol.hasInstance,{value:o=>!!o[i]}),r};Tn({order(){return[0]},includes(t){return t>=0&&t<this.size[0]},indexAt(t){return this.includes(t)?this.indexAtUnsafe(t):-1},indexAtUnsafe(t){return this.offset+(t|0)*this.stride[0]},getAt(t){return this.includes(t)?this.data[this.indexAtUnsafe(t)]:0},getAtUnsafe(t){return this.data[this.indexAtUnsafe(t)]},setAt(t,e){return this.includes(t)?(this.data[this.indexAtUnsafe(t)]=e,!0):!1},setAtUnsafe(t,e){return this.data[this.indexAtUnsafe(t)]=e,!0}});const zo=Tn({order(){return Math.abs(this.stride[1])>Math.abs(this.stride[0])?[1,0]:[0,1]},includes(t,e){const n=this.size;return t>=0&&t<n[0]&&e>=0&&e<n[1]},indexAt(t,e){return this.includes(t,e)?this.indexAtUnsafe(t,e):-1},indexAtUnsafe(t,e){return this.offset+(t|0)*this.stride[0]+(e|0)*this.stride[1]},getAt(t,e){return this.includes(t,e)?this.data[this.indexAtUnsafe(t,e)]:0},getAtUnsafe(t,e){return this.data[this.indexAtUnsafe(t,e)]},setAt(t,e,n){return this.includes(t,e)?(this.data[this.indexAtUnsafe(t,e)]=n,!0):!1},setAtUnsafe(t,e,n){return this.data[this.indexAtUnsafe(t,e)]=n,!0}});Tn({order(){return Bo(this.stride)},includes(t,e,n){const s=this.size;return t>=0&&t<s[0]&&e>=0&&e<s[1]&&n>=0&&n<s[2]},indexAt(t,e,n){return this.includes(t,e,n)?this.indexAtUnsafe(t,e,n):-1},indexAtUnsafe(t,e,n){const s=this.stride;return this.offset+(t|0)*s[0]+(e|0)*s[1]+(n|0)*s[2]},getAt(t,e,n){return this.includes(t,e,n)?this.data[this.indexAtUnsafe(t,e,n)]:0},getAtUnsafe(t,e,n){return this.data[this.indexAtUnsafe(t,e,n)]},setAt(t,e,n,s){return this.includes(t,e,n)?(this.data[this.indexAtUnsafe(t,e,n)]=s,!0):!1},setAtUnsafe(t,e,n,s){return this.data[this.indexAtUnsafe(t,e,n)]=s,!0}});Tn({order(){return Bo(this.stride)},includes(t,e,n,s){const i=this.size;return t>=0&&t<i[0]&&e>=0&&e<i[1]&&n>=0&&n<i[2]&&s>=0&&s<i[3]},indexAt(t,e,n,s){return this.includes(t,e,n,s)?this.indexAtUnsafe(t,e,n,s):-1},indexAtUnsafe(t,e,n,s){const i=this.stride;return this.offset+(t|0)*i[0]+(e|0)*i[1]+(n|0)*i[2]+(s|0)*i[3]},getAt(t,e,n,s){return this.includes(t,e,n,s)?this.data[this.indexAtUnsafe(t,e,n,s)]:0},getAtUnsafe(t,e,n,s){return this.data[this.indexAtUnsafe(t,e,n,s)]},setAt(t,e,n,s,i){return this.includes(t,e,n,s)?(this.data[this.indexAtUnsafe(t,e,n,s)]=i,!0):!1},setAtUnsafe(t,e,n,s,i){return this.data[this.indexAtUnsafe(t,e,n,s)]=i,!0}});const Bo=t=>[...t].map((e,n)=>[e,n]).sort((e,n)=>Math.abs(n[0])-Math.abs(e[0])).map(e=>e[1]);var Hf=Object.defineProperty,Vf=Object.getOwnPropertyDescriptor,Yf=(t,e,n,s)=>{for(var i=s>1?void 0:s?Vf(e,n):e,r=t.length-1,o;r>=0;r--)(o=t[r])&&(i=(s?o(e,n,i):o(i))||i);return s&&i&&Hf(e,n,i),i};let Ms=class{constructor(t,e,n,s=void 0,i=(r,o)=>{}){A(this,"size");A(this,"stride");A(this,"conversionFactor");A(this,"data",[]);A(this,"freeValue");A(this,"agents",[]);this.space=n,this.data=new Array(t*e).fill(s),this.size=[t,e],this.stride=[1,t],this.conversionFactor=[t/n.size[0],e/n.size[1]],this.freeValue=s;for(let r=0;r<t;r++)for(let o=0;o<e;o++)this.setAtUnsafe(r,o,i(r,o))}clear(){const[t,e]=this.size;for(let n=0;n<t;n++)for(let s=0;s<e;s++)this.setAtUnsafe(n,s,this.freeValue)}setAgents(t){this.agents=t}fromSpaceToGrid(t){return[Math.floor(t[0]*this.conversionFactor[0]),Math.floor(t[1]*this.conversionFactor[1])]}fromGridToSpace(t){return[t[0]/this.conversionFactor[0],t[1]/this.conversionFactor[1]]}checkCollision(t,e,n=!1,s=!1){const i=this.fromSpaceToGrid(t.getPos());return this.isCellFree(i[0],i[1],e,t)?(s&&this.setAt(i[0],i[1],t),!1):!0}isCellFree(t,e,n,s){if(this.includes(t,e)){const i=this.getAt(t,e);return i===this.freeValue||s!==void 0&&i===s}}randomFree(t,e){let n=0;for(;n<1e4;){const s=vi(t,1,y);if(s&&s.length>0){const i=this.fromSpaceToGrid(s[0]);if(this.isCellFree(Math.floor(i[0]),Math.floor(i[1]),0))return{pos:s[0],agent:void 0};n++}}return{pos:void 0,agent:void 0}}freeLine(t,e,n,s,i){const r=s*Math.min(this.width,this.height),o=Er([],n,1),a=this.fromSpaceToGrid(e);let c=It([],a,o),l=this.fromGridToSpace(c),f=0;for(;(i?hn(i,l):!0)&&this.isCellFree(Math.floor(c[0]),Math.floor(c[1]),0,t)&&f<r;)c=It([],c,o),l=this.fromGridToSpace(c),f++;return[l[0],l[1]]}randomOccupied(t,e="random point"){let n=0;for(;n<1e4;){if(e==="random point"){const s=vi(t,1,y);if(s){const i=this.fromSpaceToGrid(s[0]);if(!this.isCellFree(Math.floor(i[0]),Math.floor(i[1]),0))return{pos:[s[0][0],s[0][1]],agent:this.getAt(Math.floor(i[0]),Math.floor(i[1]))}}}else if(this.agents.length>0){const s=ws(this.agents,this.agents.map(i=>i.spaceTraveled),y);if(s.spaceTraveled>0){const i=ws(s.line,s.lengths,y);if(i.points.length>1){const r=$(i.points,y);if(hn(t,r))return{agent:s,pos:[r[0]+y.minmax(-.001,.001),r[1]+y.minmax(-.001,.001)]}}}}n++}return{pos:void 0,agent:void 0}}setAtUnsafe(t,e,n){}setAt(t,e,n){}getAt(t,e){}getAtUnsafe(t,e){}includes(t,e){}get width(){return this.size[0]}get height(){return this.size[1]}get offset(){return 0}};Ms=Yf([zo],Ms);const Wf=(t,e,n,s=window.devicePixelRatio||1)=>(s!==1&&(t.style.width=`${e}px`,t.style.height=`${n}px`),t.width=e*s,t.height=n*s,s);var L;(function(t){t[t.ALPHA=0]="ALPHA",t[t.BLUE=1]="BLUE",t[t.GREEN=2]="GREEN",t[t.RED=3]="RED"})(L||(L={}));const gn=(t,e=t,n,s={})=>{const i=document.createElement("canvas");return i.width=t,i.height=e,n&&n.appendChild(i),s.pixelated&&(i.style.imageRendering="pixelated"),{canvas:i,ctx:i.getContext("2d",s.ctx)}};function Xf(t,e){let n,s;if(O(t)){const o=gn(t,e);n=o.canvas,s=o.ctx}else n=t,s=n.getContext("2d");const i=s.getImageData(0,0,n.width,n.height),r=new Uint32Array(i.data.buffer);return{canvas:n,ctx:s,img:i,data:r}}const Zf=(t,e,n=e,s)=>{const i=O(e)?gn(e,n,s):gn(t.width,t.height,s);return i.ctx.drawImage(t,0,0,i.canvas.width,i.canvas.height),i},Jf=async(t,e="anonymous")=>{const n=new Image;return n.crossOrigin=e,n.src=t,await n.decode(),n},Kf=(t,e,n,s=1)=>E(t.length>=e*n*s,"pixel buffer too small"),Ce=(t,e)=>{const n=t.channels[e];return E(n!=null,`invalid channel ID: ${e}`),n},Qf=t=>E(!!t.alpha,"missing alpha channel");function tu(t,e,n,s){var i=arguments.length,r=i<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,n):s,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(t,e,n,s);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(r=(i<3?o(r):i>3?o(e,n,r):o(e,n))||r);return i>3&&r&&Object.defineProperty(e,n,r),r}const eu=t=>{const e=(t>>>24)/255;return t&4278190080|(t>>>16&255)*e<<16|(t>>>8&255)*e<<8|(t&255)*e},nu=t=>{const e=(t>>>24)/255;return e>0?(t&4278190080|Math.min(255,(t>>>16&255)/e)<<16|Math.min(255,(t>>>8&255)/e)<<8|Math.min(255,(t&255)/e))>>>0:t},su=t=>{const e=t>>>24;return(t>>>16&255)<=e&&(t>>>8&255)<=e&&(t&255)<=e},iu=t=>((t>>>16&255)*29+(t>>>8&255)*150+(t&255)*76)/255,vs=(t,e,n,s,i,r,o=0,a=0)=>(t|=0,e|=0,n|=0,s|=0,t<0&&(n+=t,o-=t,t=0),e<0&&(s+=e,a-=e,e=0),[t,e,st(n,0,i-t),st(s,0,r-e),o,a]),Vi=(t,e,n={})=>{const s=t.width,i=e.width;let r,o,a,c,l,f;return[r,o,l,f]=vs(n.sx||0,n.sy||0,n.w||s,n.h||t.height,s,t.height),[a,c,l,f,r,o]=vs(n.dx||0,n.dy||0,l,f,i,e.height,r,o),{sx:r,sy:o,dx:a,dy:c,rw:l,rh:f}},ru=(t,e,n)=>{for(let s=t.length;s-- >0;)t[s]=n(t[s],e)},ou=(t,e,n,s)=>{for(let i=t.length;i-- >0;)t[i]=s(t[i],n(e[i]))},au=(t,e,n,s,i)=>{const r=~i;for(let o=t.length;o-- >0;)t[o]=t[o]&r|n(s(e[o]))&i},Yi=(t,e,n)=>{const s=e.fromABGR,i=e.toABGR;for(let r=t.length;r-- >0;)t[r]=s(n(i(t[r])))},Rs=(t,e)=>e>0?`(${t} << ${e})`:e<0?`(${t} >>> ${-e})`:`${t}`,oi=(t,e)=>Rs(t,-e),Uo=t=>`0x${t.toString(16)}`,cu=t=>{const e=8-t,n=(1<<t)-1;return new Function("luma",`return (x) => ${oi("luma(x)",e)} & ${n};`)(iu)},lu=t=>{let e;if(t!==8){const n=(1<<t)-1,s=255/n;e=`(((x & ${n}) * ${s}) | 0)`}else e="x";return new Function("x",`return 0xff000000 | (${e} * 0x010101);`)},fu=t=>new Function("x","return ("+t.map(e=>{const n=e.abgrShift+(8-e.size);return`(${oi("x",n)} & ${Uo(e.maskA)})`}).join(" | ")+") >>> 0;"),uu=(t,e)=>{const n=t.map(i=>{if(i.size!==8){const r=i.mask0,o=255/r,a=oi("x",i.shift);return Rs(`((${a} & ${r}) * ${o})`,24-i.lane*8)}else return Rs(`(x & ${Uo(i.maskA)})`,i.abgrShift)}).join(" | "),s=e?"":"0xff000000 | ";return new Function("x",`return (${s}${n}) >>> 0;`)},hu=(t,e,n)=>{const s=1<<t.size,i=s-1,r=i<<n>>>0,o=~r>>>0,a=t.lane!=null?t.lane:e,c=f=>f>>>n&i,l=(f,h)=>f&o|(h&i)<<n;return{size:t.size,num:s,abgrShift:24-a*8-n,lane:a,shift:n,mask0:i,maskA:r,int:c,setInt:l,float:f=>c(f)/i,setFloat:(f,h)=>l(f,p(h)*i)}},ai=t=>{E(t.channels.length>0,"no channel specs given");const e=t.channels.reduce(([n,s],i,r)=>(s-=i.size,n.push(hu(i,r,s)),[n,s]),[[],t.size])[0];return{__packed:!0,type:t.type,size:t.size,alpha:t.alpha||0,channels:e,fromABGR:t.fromABGR||fu(e),toABGR:t.toABGR||uu(e,!!t.alpha)}},Fs=ai({type:"u32",size:32,alpha:8,channels:[{size:8,lane:L.ALPHA},{size:8,lane:L.BLUE},{size:8,lane:L.GREEN},{size:8,lane:L.RED}],fromABGR:t=>t,toABGR:t=>t});function du(t,e="linear",n="clamp"){const s=!!t.format.__float,i=t.format.channels.length===1?"1":"",r=`${e[0]}${n[0]}${i}`,o=(s?{nc1:Ee,nw1:Oe,nr1:De,nc:Ee,nw:Oe,nr:De,lc1:a=>ts(lt(a)),lw1:a=>ts(ft(a)),lr1:a=>ts(ut(a)),lc:a=>ns(a,Ee(a)),lw:a=>ns(a,Oe(a)),lr:a=>ns(a,De(a)),cc1:a=>is(lt(a)),cw1:a=>is(ft(a)),cr1:a=>is(ut(a)),cc:a=>os(a,Ee(a)),cw:a=>os(a,Oe(a)),cr:a=>os(a,De(a))}:{nc1:lt,nw1:ft,nr1:ut,nc:lt,nw:ft,nr:ut,lc1:a=>Pe(lt(a)),lw1:a=>Pe(ft(a)),lr1:a=>Pe(ut(a)),lc:a=>es(a,lt(a)),lw:a=>es(a,ft(a)),lr:a=>es(a,ut(a)),cc1:a=>ss(a,lt(a)),cw1:a=>ss(a,ft(a)),cr1:a=>ss(a,ut(a)),cc:a=>rs(a,lt(a)),cw:a=>rs(a,ft(a)),cr:a=>rs(a,ut(a))})[r];return E(!!o,`missing impl for ${r}`),o(t)}const lt=({data:t,width:e,height:n})=>(s,i)=>s>=0&&s<e&&i>=0&&i<n?t[(i|0)*e+(s|0)]:0,ft=({data:t,width:e,height:n})=>(s,i)=>t[rn(i|0,n)*e+rn(s|0,e)],ut=({data:t,width:e,height:n})=>{const s=e-1,i=n-1;return(r,o)=>t[st(o|0,0,i)*e+st(r|0,0,s)]},Ee=({data:t,width:e,height:n,stride:[s,i]})=>(r,o)=>{let a;return r>=0&&r<e&&o>=0&&o<n?(a=(o|0)*i+(r|0)*s,t.slice(a,a+s)):[0]},Oe=({data:t,width:e,height:n,stride:[s,i]})=>(r,o)=>{let a=rn(o|0,n)*i+rn(r|0,e)*s;return t.slice(a,a+s)},De=({data:t,width:e,height:n,stride:[s,i]})=>{const r=e-1,o=n-1;return(a,c)=>{let l=st(c|0,0,o)*i+st(a|0,0,r)*s;return t.slice(l,l+s)}},Jt=(t,e,n,s,i=4)=>Tr(t[s],t[s+i],t[s+2*i],t[s+3*i],e,n),Pe=t=>(e,n)=>(e-=.5,n-=.5,Tr(t(e,n),t(e+1,n),t(e,n+1),t(e+1,n+1),M(e),M(n))),ts=t=>(t=Pe(t),(e,n)=>[t(e,n)]),es=(t,e)=>{const{fromABGR:n,toABGR:s}=t.format,i=new Uint32Array(4),r=new Uint8Array(i.buffer);return(o,a)=>{o-=.5,a-=.5,i[0]=s(e(o,a)),i[1]=s(e(o+1,a)),i[2]=s(e(o,a+1)),i[3]=s(e(o+1,a+1));const c=M(o),l=M(a);return n(Jt(r,c,l,0)|Jt(r,c,l,1)<<8|Jt(r,c,l,2)<<16|Jt(r,c,l,3)<<24)>>>0}},ns=({stride:[t]},e)=>{const n=new Float32Array(t*4);return(s,i)=>{s-=.5,i-=.5,n.set(e(s,i),0),n.set(e(s+1,i),t),n.set(e(s,i+1),t*2),n.set(e(s+1,i+1),t*3);const r=M(s),o=M(i);let a=[];for(let c=0;c<t;c++)a.push(Jt(n,r,o,c,t));return a}},Po=t=>(e,n)=>{e-=.5,n-=.5;const s=e-1,i=e+1,r=e+2,o=n-1,a=n+1,c=n+2;return zr(t(s,o),t(e,o),t(i,o),t(r,o),t(s,n),t(e,n),t(i,n),t(r,n),t(s,a),t(e,a),t(i,a),t(r,a),t(s,c),t(e,c),t(i,c),t(r,c),M(e),M(n))},ss=(t,e)=>{const n=t.format.channels[0].mask0;return e=Po(e),(s,i)=>st(e(s,i),0,n)},is=t=>(t=Po(t),(e,n)=>[t(e,n)]),Go=(t,e,n,s,i=4)=>zr(t[s],t[s+i],t[s+2*i],t[s+3*i],t[s+4*i],t[s+5*i],t[s+6*i],t[s+7*i],t[s+8*i],t[s+9*i],t[s+10*i],t[s+11*i],t[s+12*i],t[s+13*i],t[s+14*i],t[s+15*i],e,n),xe=(t,e,n,s,i=4)=>st(Go(t,e,n,s,i),0,255),rs=(t,e)=>{const{fromABGR:n,toABGR:s}=t.format,i=new Uint32Array(16),r=new Uint8Array(i.buffer);return(o,a)=>{o-=.5,a-=.5;const c=o-1,l=o+1,f=o+2,h=a-1,u=a+1,g=a+2,d=M(o),m=M(a);return i[0]=s(e(c,h)),i[1]=s(e(o,h)),i[2]=s(e(l,h)),i[3]=s(e(f,h)),i[4]=s(e(c,a)),i[5]=s(e(o,a)),i[6]=s(e(l,a)),i[7]=s(e(f,a)),i[8]=s(e(c,u)),i[9]=s(e(o,u)),i[10]=s(e(l,u)),i[11]=s(e(f,u)),i[12]=s(e(c,g)),i[13]=s(e(o,g)),i[14]=s(e(l,g)),i[15]=s(e(f,g)),n(xe(r,d,m,0)|xe(r,d,m,1)<<8|xe(r,d,m,2)<<16|xe(r,d,m,3)<<24)>>>0}},os=({stride:[t]},e)=>{const n=new Float32Array(t*16);return(s,i)=>{s-=.5,i-=.5;const r=s-1,o=s+1,a=s+2,c=i-1,l=i+1,f=i+2,h=M(s),u=M(i);n.set(e(r,c),0),n.set(e(s,c),t),n.set(e(o,c),2*t),n.set(e(a,c),3*t),n.set(e(r,i),4*t),n.set(e(s,i),5*t),n.set(e(o,i),6*t),n.set(e(a,i),7*t),n.set(e(r,l),8*t),n.set(e(s,l),9*t),n.set(e(o,l),10*t),n.set(e(a,l),11*t),n.set(e(r,f),12*t),n.set(e(s,f),13*t),n.set(e(o,f),14*t),n.set(e(a,f),15*t);let g=[];for(let d=0;d<t;d++)g.push(Go(n,h,u,d,t));return g}};var Mt;function gu(...t){return t[0]instanceof Ae?t[0].as(t[1]):new Ae(...t)}const mu=(t,e,n,s=n)=>pu(Zf(t,n,s).canvas,e),pu=(t,e=Fs)=>{const n=Xf(t),s=t.width,i=t.height;let r;if(e===Fs)r=n.data;else{r=hs(e.type,s*i);const o=n.data,a=e.fromABGR;for(let c=r.length;c-- >0;)r[c]=a(o[c])}return new Ae(s,i,e,r)};let Ae=Mt=class{constructor(e,n,s=Fs,i){this.size=[e,n],this.stride=[1,e],this.format=s.__packed?s:ai(s),this.data=i||hs(s.type,e*n)}get pixels(){return this.data}get width(){return this.size[0]}get height(){return this.size[1]}get offset(){return 0}get dim(){return 2}as(e){return this.getRegion(0,0,this.width,this.height,e)}copy(){const e=this.empty();return e.data.set(this.data),e}empty(){return new Mt(this.width,this.height,this.format)}order(){}includes(e,n){}indexAt(e,n){}indexAtUnsafe(e,n){}getAt(e,n){}getAtUnsafe(e,n){}setAt(e,n,s){}setAtUnsafe(e,n,s){}getChannelAt(e,n,s,i=!1){const r=Ce(this.format,s),o=this.getAt(e,n);return i?r.float(o):r.int(o)}setChannelAt(e,n,s,i,r=!1){const o=Ce(this.format,s),a=this.getAt(e,n);return r?o.setFloat(a,i):o.setInt(a,i),this}blend(e,n,s){let i=this.width,r=n.width;const{sx:o,sy:a,dx:c,dy:l,rw:f,rh:h}=Vi(this,n,s);if(f<1||h<1)return n;const u=this.data,g=n.data,d=this.format.toABGR,m=n.format.toABGR,b=n.format.fromABGR;for(let w=(o|0)+(a|0)*i,C=(c|0)+(l|0)*r,pt=0;pt<h;pt++,w+=i,C+=r)for(let X=0;X<f;X++)g[C+X]=b(e(d(u[w+X]),m(g[C+X])));return n}blit(e,n){let s=this.width,i=e.width;const{sx:r,sy:o,dx:a,dy:c,rw:l,rh:f}=Vi(this,e,n);if(l<1||f<1)return e;const h=this.data,u=e.data,g=this.format.toABGR,d=e.format.fromABGR,m=this.format!==e.format?(b,w)=>{for(let C=0;C<l;C++)u[w+C]=d(g(h[b+C]))}:(b,w)=>u.set(h.subarray(b,b+l),w);for(let b=(r|0)+(o|0)*s,w=(a|0)+(c|0)*i,C=0;C<f;C++,b+=s,w+=i)m(b,w);return e}blitCanvas(e,n=0,s=0){(e instanceof HTMLCanvasElement?e.getContext("2d"):e).putImageData(this.toImageData(),n,s)}toImageData(){const e=new ImageData(this.width,this.height),n=new Uint32Array(e.data.buffer),s=this.data,i=this.format.toABGR;for(let r=n.length;r-- >0;)n[r]=i(s[r]);return e}getRegion(e,n,s,i,r){const[o,a,c,l]=vs(e,n,s,i,this.width,this.height);return this.blit(new Mt(c,l,r||this.format),{sx:o,sy:a,w:c,h:l})}getChannel(e){const n=Ce(this.format,e),s=new Mt(this.width,this.height,{type:Tc(n.size),size:n.size,channels:[{size:n.size,lane:L.RED}],fromABGR:cu(n.size),toABGR:lu(n.size)}),i=this.data,r=s.data,o=n.int;for(let a=i.length;a-- >0;)r[a]=o(i[a]);return s}setChannel(e,n){const s=Ce(this.format,e),i=this.data,r=s.setInt;if(O(n))ru(i,n,r);else{const o=n.data,a=n.format.channels[0];Kf(o,this.width,this.height),s.size===a.size?ou(i,o,a.int,r):au(i,o,this.format.fromABGR,n.format.toABGR,s.maskA)}return this}invert(){const{data:e,format:n}=this,s=Math.pow(2,n.size-n.alpha)-1;for(let i=e.length;i-- >0;)e[i]^=s;return this}premultiply(){return Qf(this.format),Yi(this.data,this.format,eu),this}postmultiply(){return Yi(this.data,this.format,nu),this}isPremultiplied(){const e=this.data,n=this.format.toABGR;for(let s=e.length;s-- >0;)if(!su(n(e[s])))return!1;return!0}forEach(e){const n=this.data;for(let s=n.length;s-- >0;)n[s]=e(n[s],s);return this}fill(e){this.data.fill(e)}flipY(){const{data:e,width:n}=this,s=hs(this.format.type,n);for(let i=0,r=e.length-n;i<r;i+=n,r-=n)s.set(e.subarray(i,i+n)),e.copyWithin(i,r,r+n),e.set(s,r);return this}scale(e,n="linear"){return E(e>0,"scale must be > 0"),this.resize(this.width*e,this.height*e,n)}resize(e,n,s="linear"){e|=0,n|=0,E(e>0&&n>0,"target width & height must be > 0");const i=gu(e,n,this.format),r=i.data,o=e>0?this.width/e:0,a=n>0?this.height/n:0;s=I(s)?du(this,s,"repeat"):s;for(let c=0,l=0;c<n;c++){const f=c*a;for(let h=0;h<e;h++,l++)r[l]=s(h*o,f)}return i}upsize(){const{width:e,height:n,data:s}=this,i=new Mt(e*2,n*2,this.format),r=i.data;for(let o=0,a=0;o<n;o++)for(let c=0,l=o*e*4;c<e;c++,a++,l+=2)r[l]=s[a];return i}};Ae=Mt=tu([zo],Ae);const bu=ai({type:"u32",size:32,alpha:8,channels:[{size:8,lane:L.ALPHA},{size:8,lane:L.RED},{size:8,lane:L.GREEN},{size:8,lane:L.BLUE}],fromABGR:un,toABGR:un}),as={iskra:["#FCF9F0","#262220"],hypothetically:["#2E0D00","#0CA5AE","#B12800"],coffee:["#262220","#FCF1D2"],coffee_plus_red:["#262220","#FCF1D2","#D82220"],parcel:["#DBCBB2","#0A121C"],dark:["#111111","#FCFCFC"],black_on_white:["#FFFFFF","#000000"],whiteOnBlack:["#000000","#FFFFFF"],blueprint:["#141D50","#F8F9F9"],blueprint_dark:["#191B27","#D2D4C5"],grey:["#373737","#D9D9D9"],red:["#A92218","#131313"],red_plus:["#7f0233","#fedac0","#c52b3e"],bloody:["#1c1418","#857e6b","#8c433a","#ba4033","#c8a15c","#d0c1ae"],mondrian:["#1c1418","#000000","#DD0100","#225095","#FAC901","#FFFFFF"],blueScale:["#18141c",...Gi(10,Li([0,0,.102],[.933,.996,1])).map(t=>me(ji(null,Hi(.8),t)))],redScale:["#1c1418",...Gi(10,Li([.067,0,0,1],[1,.996,.933,1])).map(t=>me(ji(null,Hi(.8),t)))],tm_1:["#f2ebe5","#502527","#366974","#d93d0f"],tm_2:["#e2cdb5","#49332d","#715650","#9e8178"],tm_3:["#d6dac2","#101012","#973828","#556150"],tm_4:["#d9ddd9","#070b04","#2e3911","#646e32"],tm_5:["#eef5fa","#0a0320","#260d6c","#613dda"],severance:["#BBCFD4","#1B2937","#5C7F68","#223C33"],control_room_1:["#bbe3d5","#3f322f","#71a99a","#d06f4c"],control_room_2:["#7f0233","#2f112d","#c52b3e","#fedac0"],control_room_3:["#6f6166","#1c161c","#9f8b8c","#fbeae4"],control_room_inv:["#7f0233","#fedac0","#c52b3e","#2f112d"]},cs={radial_center:{type:"radial",opts:{center:[.5,.5],clamp:!0},rotation:0,quantization:0},troublemaker:[{type:"clifford",opts:{a:-1.4,b:1.6,c:1,d:.7},quantization:0,rotation:0},{type:"clifford",opts:{a:1.7,b:1.7,c:.6,d:1.2},quantization:0,rotation:0},{type:"deJong",opts:{a:1.4,b:-2.3,c:2.4,d:-2.1},quantization:0,rotation:0},{type:"perlin",opts:{lod:2,falloff:.8,scale:50},quantization:0,rotation:0},{type:"perlin",opts:{lod:2,falloff:.4673,scale:50},quantization:0,rotation:0},{type:"simplex",opts:{amplitude:.2347,scale:17},quantization:0,rotation:0},{type:"aCosX",opts:{scale:32,amplitude:.1},quantization:0,rotation:0},{type:"sinTimesCos",opts:{scale:32,amplitude:.1},quantization:0,rotation:0},{type:"hopalong",opts:{a:1.17,b:.44,c:2.56},quantization:0,rotation:0},{type:"bedhead",opts:{a:-8.1,b:-9.2},quantization:0,rotation:0},{type:"fractalDream",opts:{d:.74,a:-29.6,b:-23,c:.77},quantization:0,rotation:0},{type:"gumowskiMira",opts:{a:.01,b:-.7},quantization:0,rotation:0}]},yu={two_by_two:{xRes:1280,yRes:({xRes:t,aspectRatio:e})=>t/e,aspectRatio:1,gridFactor:.1,step:({xRes:t})=>1/t,assets:[],style:[{type:"line",alphaDecay:()=>t=>t*t,followBounds:!1,weightFactor:1,doubleSided:!1,maxLength:.05,grainsFactor:$([70,200,400],y),minAlpha:$([.1,.2],y)},{type:"sanded line",alphaDecay:()=>t=>t*t*t,followBounds:!1,weightFactor:.6,doubleSided:!1,maxLength:.1,grainsFactor:$([300,600],y),minAlpha:$([.001],y)},{type:"points",alphaDecay:()=>t=>t*t,followBounds:!1,weightFactor:5,doubleSided:!1,maxLength:.05,grainsFactor:$([70,200,400],y),minAlpha:$([.1,.2],y)},{type:"line",alphaDecay:()=>t=>t*t,followBounds:!1,weightFactor:5,doubleSided:!1,maxLength:.05,grainsFactor:$([70,200,400],y),minAlpha:$([.1,.2],y)}],colors:$([{bg:[as.coffee_plus_red[0]],fg:[...Of([{range:"cool",base:dn(as.coffee_plus_red[1]),weight:2},{range:"warm",base:dn(as.coffee_plus_red[2])}],{num:15,variance:.05})].map(t=>me(t))}]),vector_field:[cs.radial_center,$(cs.troublemaker),$(cs.troublemaker)],agents:({style:t})=>({maxNewPerFrame:3,initialStep:1e-4,angled:!1,branch:2,maxActive:1e3,maxLineLength:[1,1],maxSpaceTraveled:5,chance:1,fuzziness:0,...$([{initial:10,max:500,maxIterations:2e4},{initial:10,max:1e3,maxIterations:2e4},{initial:10,max:1500,maxIterations:1e5}]),initialDirections:[[0,1],[0,-1]]}),bounds:({agents:t})=>{let e=$([yt([.1,.1],[.9,.9])]);return{overall:[yt([.1,.1],[.9,.9])],update:[e],init:[yt([.1,.1],[.9,.9]),yt([.1,.1],[.9,.9]),yt([.1,.1],[.9,.9]),yt([.1,.1],[.9,.9])]}},weight:$([{values:ws([[6,.01]],[1,1]),factor:"distancePosCenter",fn:()=>(t,e,n)=>on(t,e,n*6)}]),alpha:{values:[.82,.1],using:"colors",factor:"agentID",fn:()=>(t,e,n)=>y.minmax(t,e)},stroke:({colors:t})=>(t.fg.length,{values:[0,1],using:"colors",factor:$(["random"]),fn:(e,n,s)=>on(e,n,s)}),events:[]}},wu=()=>As({iterations:0,lineSlice:3e4,presetId:$(["two_by_two"],y),preset:({presetId:t})=>As({...yu[t]},{onlyFnRefs:!0})},{onlyFnRefs:!0}),Lo=(t,e)=>As({...t,margin:0,useFixedSizeCanvas:!0,fixedHeight:e.yRes,fixedWidth:e.xRes,dpr:({useFixedSizeCanvas:n})=>n?2:window.devicePixelRatio||1,width:({margin:n})=>t.width/t.height<=e.aspectRatio?t.width-2*n:t.height*e.aspectRatio-2*n,height:({margin:n})=>t.width/t.height<=e.aspectRatio?t.width/e.aspectRatio-2*n:t.height-2*n,scaledSize:({width:n,height:s,dpr:i,useFixedSizeCanvas:r,fixedHeight:o,fixedWidth:a})=>[r?a*i:n*i,r?o*i:s*i],aspect:({width:n,height:s})=>n/s,canvas:({width:n,height:s,dpr:i,scaledSize:r,useFixedSizeCanvas:o})=>{let a;const c=document.getElementById("main");return c?a={canvas:c,ctx:c.getContext("2d")}:(a=gn(n,s,document.getElementById("app")),a.canvas.setAttribute("id","main"),o&&(a.canvas.width=r[0],a.canvas.height=r[1])),o?(a.canvas.style.width=`${n}px`,a.canvas.style.height=`${s}px`):Wf(a.canvas,n,s),a}},{onlyFnRefs:!0}),Au=async t=>Promise.all(t.map(e=>Jf(e))).then(e=>e.map(n=>mu(n,bu)));class Su{constructor(e){this.events=e;for(const n of e)n.triggered=!1}checkEvents(e,n){for(let s of this.events)if((s.trigger.repeat==="always"||!s.triggered)&&this.getFactor(s.trigger.factor,e,n)>=s.trigger.threshold){s.triggered=!0;const r=s.action.fn();s.action.value==="vector_field"&&n.agents.forEach(o=>o.vectorField=yo(r.type,r.opts,r.rotation,r.quantization)),s.action.value==="vector_field/opts/scale"&&n.agents.forEach(o=>o.vectorField.opts.scale=r),s.action.value==="agents/useVectorFieldTransform"&&n.agents.forEach(o=>o.useVectorFieldTransform=r),s.action.value==="style"&&((r.type==="line"||r.type==="points")&&(n.AgentConstructor=ni),r.type==="sanded line"&&(n.AgentConstructor=Ao)),s.action.value==="stroke"&&(n.agentAttribs.preset.stroke=r)}}getFactor(e,n,s){switch(e){case"agentID":return s.agents.length/n.agents.max;case"spaceTraveled":return s.spaceTraveled}return 1}}let it,qo,wt,Ge=!0;const mn=3;let tt=[],Ne=[],oe=!1,jo,$s,Mu=!1;const vu=async()=>{it=wu();const{preset:t}=it;wt=Lo({width:window.innerWidth,height:window.innerHeight},t);const{canvas:e,scaledSize:n}=wt;u0()&&($s=oa(e.canvas,fxhash,{fps:30})),qo=await Au(t.assets),ci()},ci=()=>{Ne=[],tt=[];const{preset:t,presetId:e}=it,{vector_field:n,gridFactor:s,xRes:i,yRes:r,agents:o,bounds:a,style:c,aspectRatio:l,events:f}=t,h=new Ms(Math.floor(i*s),Math.floor(r*s),cn([0,0],[1*l,1]),0,(d,m)=>0);t.vector_field=v0(t.vector_field,3,y);for(let d=0;d<mn;d++)Ne.push(yo(t.vector_field[d].type,t.vector_field[d].opts,t.vector_field[d].rotation,t.vector_field[d].quantization)),tt.push(new V0(h,Ne[d],o,o.initialStep,a.overall,a.update,new jf(t,t.style[d],qo),c[d].type==="sanded line"?Ao:ni,!1));window.agentManagers=tt;const{canvas:u,scaledSize:g}=wt;pe(u.ctx,an({lineCap:"round"},$u(g,t))),new Su(f);for(let d=0;d<mn;d++)tt[d].createAgent(!1,t.bounds.init[d],t.bounds.overall[0],t.agents.initialDirections,Ne[d],!1,m=>m);zn()},zn=()=>{const{preset:t}=it,{canvas:e}=wt;let n=!1;for(let a=0;a<mn;a++)tt[a].updateAgents(t.step,t.agents.branch,t.agents.maxNewPerFrame,t.style[a].type==="points"?{fuzziness:0,chance:.03}:{fuzziness:0,chance:1},!0)&&(n=!0);const s=tt.map(a=>a.spaceTraveled),i=Math.min(...s),r=s.indexOf(i);tt[r].createAgent(!0,t.bounds.init[0],t.bounds.overall[0],[],tt[r].vectorField,oe);const o=Fu(it,wt);pe(e.ctx,o),n||(oe=!oe,ci()),n&&Ge&&(jo=requestAnimationFrame(zn))},Ru=()=>{cancelAnimationFrame(jo),wt=Lo({width:window.innerWidth,height:window.innerHeight},it.preset),zn()},Fu=({preset:t,lineSlice:e,presetId:n},{scaledSize:s})=>{let i=[];for(let o=0;o<mn;o++){const a=tt[o].getAgents(!Mu).map(c=>c.getShape(Vc(s[0]/t.aspectRatio,s[1]),t.style[o],3));i=i.concat(a)}return an({lineCap:"round"},i)},$u=(t,e,n)=>[cn(t,{fill:e.colors.bg[0]})];window.onkeydown=t=>{switch(t.key){case"p":oe=!oe,ci();break;case" ":Ge=!Ge,Ge&&zn();break;case"s":ra(wt.canvas.canvas,`${it.presetId}-${fxhash}-${ia()}`);break;case"q":console.log("starting canvas video recording"),$s.start();break;case"w":console.log("stopping canvas video recording"),$s.stop();break}};window.onresize=Ru;vu();window.$fxhashFeatures={preset:it.presetId};aa("state",it);
